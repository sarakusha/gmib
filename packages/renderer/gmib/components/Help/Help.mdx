import KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';
import KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';
import KeyboardArrowLeftIcon from '@mui/icons-material/KeyboardArrowLeft';
import MenuIcon from '@mui/icons-material/Menu';
import SaveIcon from '@mui/icons-material/Save';
import LoadIcon from '@mui/icons-material/SystemUpdateAlt';
import SearchIcon from '@mui/icons-material/Search';
import Filter4Icon from '@mui/icons-material/Filter4';
import RefreshIcon from '@mui/icons-material/Refresh';
import BrightnessAutoIcon from '@mui/icons-material/BrightnessAuto';
import LockIcon from '@mui/icons-material/Lock';
import Brightness4Icon from '@mui/icons-material/Brightness4';
import BrightnessHighIcon from '@mui/icons-material/BrightnessHigh';
import AddToQueue from '@mui/icons-material/AddToQueue';
import CloseIcon from '@mui/icons-material/Close';

# GMIB

### Содержание

1. [О программе](#about)
2. [Работа с приложением](#app-anchor)
   1. [Устройства](#devices-anchor)
      - [Вкладка _Свойства_](#props-anchor)
      - [Вкладка _Телеметрия_](#telemetry-anchor)
      - [Вкладка _Прошивка_](#firmware-anchor)
   2. [Вывод](#output-anchor)
   3. [Автояркость](#autobrightness-anchor)
   4. [Защита от перегрева](#overheat-anchor)
   5. [Журнал](#log-anchor)
3. [Поиск новых устройств](#find-anchor)

## <a id="about"></a> О программе

Название GMIB происходит от начальных букв Graphical User Interface of
[Management Information Base](https://ru.wikipedia.org/wiki/Management_Information_Base)
(графический интерфейс для базы управляющей информации). Изначально данное ПО разрабатывалось для
управления периферийным оборудованием производства компании Ната-Инфо, а именно для опроса состояния
оборудования (хранящегося в различных переменных), изменения его параметров, выполнения встроенных
подпрограмм на оборудовании, обновления и записи аппаратного ПО. В качестве сети связи
использовалась промышленная сеть на собственном проприетарном протоколе NiBUS работающем по
стандарту физического уровня для асинхронных интерфейсов RS-485.

Каждый тип оборудования, поддерживающий управление с помощью протокола NIBUS, хранит описание своей управляющей
информации в специальных MIB-файлах с описанием схемы в формате XSD. Для опроса и управления оборудованием можно
воспользоваться инструментом для командной строки Windows, указав нужный MIB-файл и требуемую команду,
что может быть несколько неудобно и сложно, особенно для неподготовленных пользователей. Данная программа позволяет 
автоматически обнаруживать и идентифицировать подключенные периферийные устройства, предоставляет удобный
интерфейс для управления ими, является мультиплатформенной и поддерживает основные ОС: Windows, Linux, macOS.
Поддерживаются такие функции как:

* подключение устройств по USB и Ethernet;
* задание параметров (размер, расположение, яркость, адреса устройств) для управления подключенными видеоэкранами;
* автоматическое управление яркостью видеоэкранов по показаниям датчиков освещенности или положению солнца, с указанием географических координат установленного оборудования;
* периодическое получение и сохранение телеметрии, снижение яркости видеоэкранов при превышении критической температуры оборудования;
* автоматический запуск, автообновление, авторизация и аутентификация, удаленное подключение и управление;
* поддержка популярных устройств и видеоэкранов сторонних производителей, показ графической информации на видеоэкранах, вывод HTML-страниц;
* создание плейлистов с видеоконтентом и воспроизведение видео на экранах;
* планировщик заданий;

Основной режим работы программы — автономный, «настроил и забыл». Оператор подключает оборудование, задает настройки,
включает автозапуск. Далее программа самостоятельно отслеживает текущий статус оборудования, изменяет параметры
согласно заданному плану или в случае нештатных ситуаций.

## <a id="app-anchor"></a> Работа с приложением

Интерфейс приложения включает в себя _Меню_, _Навигационную панель_ (**<abbr>НП</abbr>**) в левой
части окна и _Рабочее пространство_ (**<abbr>РП</abbr>**) с названием приложения и текущей версией.
РП может содержать _Панель инструментов_ (**<abbr>ПИ</abbr>**) и _Вкладки_, а содержание зависит от
выбранного пункта в НП. Чтобы понять, за что отвечает та или иная кнопка в ПИ достаточно подвести
курсор к выбранной кнопке и прочитать "всплывающую" подсказку.

> Некоторые пункты **НП** или группы свойств могут содержать вложенные списки. Тогда рядом с
> названием пункта или группы отображается символы <KeyboardArrowUpIcon /> или <KeyboardArrowDownIcon />
> кликнув по которым можно свернуть/развернуть вложенный список. Саму **НП** так же можно скрыть/отобразить
> кликнув по символу <KeyboardArrowLeftIcon /> или <MenuIcon />

### <a id="devices-anchor"></a>Устройства

При запуске и в процессе работы приложение будет подключать доступные устройства и устройства
перечисленные в конфигурации экранов и добавлять их в список Устройства в НП. При выборе устройства
в РП могут быть доступны следующие вкладки:

#### <a id="props-anchor"></a>Вкладка _Свойства_

Каждое такое устройство из списка можно выбрать кликнув по нему мышью и в области РП будут
отображаться свойства выбранного устройства, часть из которых можно изменять пользователю.

> Изменение свойств устройства относится к "тонкой" настройке, и должно выполняться
> квалифицированным специалистом. Рядовым пользователям при повседневной эксплуатации обычно не
> требуется изменять эти свойства. Также некоторые свойства, такие как яркость управляются
> централизованно и не должны изменяться для индивидуальных устройств.

Если свойств достаточно много, то они могут быть сгруппированы по группам.

На панели инструментов вкладки Свойства могут быть доступны следующие действия:

<dl>
  <dt> <LoadIcon /> Загрузить свойства из файла.</dt>
  <dd>Загружает сохраненные ранее свойства из указанного файла.</dd>

  <dt> <SaveIcon /> Сохранить выбранные свойства в файл. </dt>
  <dd>Позволяет сохранить все или указанные значения изменяемых свойств в указанный файл.</dd> 

  <dt><RefreshIcon /> Обновить свойства.</dt>
  <dd>Повторно перечитать все свойства с устройства.</dd>

  <dt> <SearchIcon /> [Поиск новых устройств](#find-anchor)</dt>
</dl>

#### <a id="telemetry-anchor"></a>Вкладка _Телеметрия_

Для некоторых устройств/видеоэкранов доступно получение телеметрии от каждого модуля, которая может
содержать такие параметры как:

- напряжение
- температура
- версия прошивки
- цветовые координаты
- и т.д.

На панели инструментов вкладки _Телеметрия_ доступны следующие действия:

<dl>
  <dt><Filter4Icon /> Выбрать запрашиваемые переменные</dt>
  <dd>Вызывает диалог выбора интересующих параметров (отображает количество выбранных параметров)</dd>

  <dt><RefreshIcon /> Запустить опрос модулей</dt>
  <dd>Запускается запрос данных телеметрии указанного диапазона экрана</dd>
</dl>

Также используя слайдеры можно задать диапазон опрашиваемых модулей по рядам и строкам (на некоторых
устройствах может быть недоступно).

В процессе опроса данные телеметрии будут выдаваться в табличном виде.

> Чем больше запрашиваемых параметров тем дольше производится опрос. Указывайте только интересуемые
> параметры.

#### <a id="firmware-anchor"></a>Вкладка _Прошивка_

Это экспериментальная возможность и предназначена только для специалистов!

### <a id="output-anchor"></a>Вывод

Если выбрать данный пункт в НП, то слева можно увидеть список переключателей тестовых режимов, а
справа вкладки с доступными экранами и их параметрами. Включение/выключение переключателя
отображает/скрывает динамический тест на выбранном экране.

На панели инструментов расположены следующие элементы:

<dl>
  <dt><BrightnessAutoIcon /> Автояркость</dt>
  <dd>Включает/выключает режим автояркости для выбранного экрана. Если экран в режиме автояркости, то вы не можете указать индивидуальную яркость, она задается централизованно</dd>

  <dt>**75%** Текущая яркость</dt>
  <dd>Отображает текущую яркость в процентах</dd>

  <dt><Brightness4Icon /> Уменьшить на единицу</dt>
  <dd>Уменьшает яркость на один процентный пункт. Не активен в режиме автояркость</dd>
  
  <dt>**Слайдер/ползунок**</dt>
  <dd>Задать яркость. Не активен в режиме автояркость</dd>
  
  <dt><BrightnessHighIcon /> Увеличить на единицу</dt>
  <dd>Увеличивает яркость на один процентный пункт. Не активен в режиме автояркость</dd>

  <dt><LockIcon /> Разблокировать/заблокировать изменения</dt>
  <dd>Так как свойства экрана меняются достаточно редко, то чтобы настройки не сбились, перед внесением правок необходимо сначала разблокировать свойства экрана</dd>
</dl>

Перед внесением изменений разблокируйте свойства из панели инструментов. После разблокировки можно
создать новый экран кликнув на вкладке по символу <AddToQueue /> или удалить его <CloseIcon />.

Параметры позволяют задать размеры экрана в пикселях, размеры модуля/платы, отступ верхнего левого
угла экрана и дисплей, на который выводить изображение. Дисплей можно указать как _основной_ или
_второстепенный_, либо по его идентификатору. Чтобы узнать идентификатор дисплея, его необходимо
подключить, тогда его номер отобразится в списке доступных.

Также важно задать логические или сетевые адреса минихостов, если вы хотите централизованно
управлять их яркостью и другими параметрами. Каждый экран должен содержать непересекающийся список
адресов. Устройства с указанными адресами будут автоматически обнаружены и включены в список
устройств.

Параметр _Коэффициент_ автояркости может помочь, когда в режиме автояркость используются несколько
экранов с различной абсолютной яркостью. Яркость данного экрана будет рассчитана как общая яркость
(в пункте _Автояркость_) умноженная на указанный коэффициент. Если этот коэффициент равен нулю,
яркость экрана управляется индивидуально и не зависит от общей яркости.

### <a id="autobrightness-anchor"></a>Автояркость

В левой части находится переключатель, который активирует режим автояркости. В этом режиме текущая
яркость рассчитывается на основе данных, поступающих от внешнего датчика освещенности. Полученные
данные об освещенности в люксах отображаются на полукруглой логарифмической шкале в верхней части
окна. Под циферблатом находится таблица соответствия между освещенностью и яркостью.

> Не обязательно заполнять всю таблицу, но два крайних значения являются обязательными - это
> минимальная и максимальная яркость. Также освещенность и яркость должны возрастать для каждой
> строки таблицы. Текущий уровень яркости будет вычисляться с помощью интерполяции заданных значений
> и лежать в диапазоне от минимальной до максимальной указанной яркости.

Если датчик освещенности отсутствует или неисправен, текущая яркость может быть рассчитана по высоте
солнца. Для этого вам необходимо задать текущие координаты GPS. В этом случае также нужно указать
два крайних значения в таблице: минимальную и максимальную яркость.

> Обратите внимание, что точные координаты должны быть записаны в десятичной нотации, а не в минутах
> и секундах!

В правом углу отображается текущая общая яркость и слайдер, с помощью которого можно ее изменять,
если не включен режим автояркости. Данная яркость будет применена ко всем экранам, для которых
включен режим автояркости (параметр _Коэффициент автояркости_ отличен от нуля).

### <a id="overheat-anchor"></a>Защита от перегрева

Активируется переключателем. Защита от перегрева работает следующим образом: через определенный
_интервал_ времени считывается температура со всех модулей экрана. Далее, в зависимости от заданного
параметра _температуры_ выбирается _максимальное_, _среднее_ или _медианное_ значение и, если оно
превышает _нижнюю границу_ температурного диапазона, яркость экрана уменьшается на указанный _шаг
понижения_. Если в следующем опросе повышение температуры прекратилось, яркость не меняется. Если
температура продолжает расти или она превысила _верхнюю границу_, яркость понижается еще на один
шаг. Если температура опустилась за _нижнюю границу_, яркость начинает возвращаться к желаемому
значению также пошагово.

> Важное замечание: яркость в интерфейсе приложения - это, так называемая, желаемая яркость. Если
> включена защита от перегрева, реальная яркость может быть меньше. Ее реальное значение можно
> увидеть в свойствах устройства.

### <a id="log-anchor"></a>Журнал

В журнал записывается различная отладочная информация.

На панели инструментов есть кнопка вызова диалогового окна, которое позволяет выбрать уровень
логирования пересылаемых пакетов и может быть использовано разработчиками.

### <a id="remote-control"></a>Удаленное управление

Запущенные экземпляры программы на устройствах в локальной сети (в
рамках одной подсети) могут автоматически обнаруживать друг друга. Все обнаруженные устройства
перечислены в меню _GMIB_ как имя хоста с IP-адресом. При выборе указанного
пункта открывается новое окно и происходит подключение к удаленному хосту. Если это первое
подключение, то запрашивается пароль. При удачном подключении пароль сохраняется и больше не
запрашивается до его явной смены или сброса всех установок на одном из хостов.

> Все запросы к удаленному хосту подписываются, и важно, чтобы время
> на обоих устройствах было синхронизировано. Если аутентификация не проходит убедитесь, что время
> на устройствах совпадает.

В заголовке нового окна отображается имя и адрес удаленного хоста.
Теперь вы можете управлять подключенными устройствами, как будто вы находитесь за удаленным
компьютером. Если удаленное устройство находится в другой подсети, Вы можете добавить его в список
самостоятельно выбрав в меню _Изменить список..._, откроется диалог в котором Вы можете отредактировать
список пользовательских удаленных хостов.


## <a id="find-anchor"></a>Поиск новых устройств

Диалог _Поиск устройств_ можно вызвать кликнув по символу <SearchIcon /> на панели инструментов. С
его помощью можно найти устройства, подключенные к сети NIBUS по RS-485 интерфейсу. Обычно Ваш
компьютер должен быть подключен к общей сети посредством устройства Siolynx.

Поиск устройств можно осуществить по _типу_ или по _адресу_. Если вы подключены к нескольким сетям,
можно выбрать активное _соединение_, либо искать во всех сетях. Если используется поиск по типу
устройства, нужно выбрать искомый тип из выпадающего списка. Если поиск по адресу, то укажите
искомый адрес. Если все задано, можно начать поиск кликнув кнопку с надписью _Начать_. Если поиск
затянулся, его можно остановить кликнув на _Остановить_. Процесс поиска сопровождается движением
полоски индикатора выполнения. Также в окне будут появляться обнаруженные устройства. Их можно
добавить в общий список устройств кликнув по символу плюс рядом с устройством.

> Если адрес устройства перечислен в свойствах экрана, его поиск будет осуществляться автоматически.
