import KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';
import KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';
import KeyboardArrowLeftIcon from '@mui/icons-material/KeyboardArrowLeft';
import MenuIcon from '@mui/icons-material/Menu';
import SaveIcon from '@mui/icons-material/Save';
import LoadIcon from '@mui/icons-material/SystemUpdateAlt';
import SearchIcon from '@mui/icons-material/Search';
import Filter4Icon from '@mui/icons-material/Filter4';
import RefreshIcon from '@mui/icons-material/Refresh';
import BrightnessAutoIcon from '@mui/icons-material/BrightnessAuto';
import LockIcon from '@mui/icons-material/Lock';
import Brightness4Icon from '@mui/icons-material/Brightness4';
import BrightnessHighIcon from '@mui/icons-material/BrightnessHigh';
import AddToQueue from '@mui/icons-material/AddToQueue';
import CloseIcon from '@mui/icons-material/Close';

# GMIB

### Содержание

1. [О программе](#about)
2. [Работа с приложением](#app-anchor)
    1. [Устройства](#devices-anchor)
        * [Вкладка *Свойства*](#props-anchor)
        * [Вкладка *Телеметрия*](#telemetry-anchor)
        * [Вкладка *Прошивка*](#firmware-anchor)
    2. [Вывод](#output-anchor)
    3. [Автояркость](#autobrightness-anchor)
    4. [Защита от перегрева](#overheat-anchor)
    5. [Журнал](#log-anchor)
3. [Поиск новых устройств](#find-anchor)

## <a name="about">О программе</a>

Приложение GMIB предназначено для управления и настройки периферийного оборудования производства компании <a href="https://www.nata-info.ru" target="_blank">Ната-Инфо</a>,
использующее протокол NIBUS. Также может поддерживаться оборудование совместимое с протоколом Novastar. Основное назначение - это управление
видеоэкранами, которое включает: первоначальную настройку, управление яркостью, режим автояркости (по датчику освещения/положению солнца),
получение телеметрии, защиту от перегрева.

Приложение может работать под управлением операционных систем Windows, Linux, macOS.

## <a name="app-anchor">Работа с приложением</a>

Интерфейс приложения включает в себя *Меню*, *Навигационную панель* (**<abbr>НП</abbr>**) в левой части окна и *Рабочее пространство* (**<abbr>РП</abbr>**)
с названием приложения и текущей версией, которое может содержать *Панель инструментов* (**<abbr>ПИ</abbr>**) и *Вкладки*, а содержание зависит
от выбранного пункта в **НП**. Чтобы понять за что отвечает та или иная кнопка в **ПИ** достаточно подвести курсор к выбранной кнопке и
прочитать "всплывающую" подсказку.

> Некоторые пункты **НП** или группы свойств могут содержать вложенные списки. Тогда рядом с названием пункта или группы отображается
символы <KeyboardArrowUpIcon /> или <KeyboardArrowDownIcon /> кликнув по которым можно свернуть/развернуть вложенный список. Саму
**НП** так же можно скрыть/отобразить кликнув по символу <KeyboardArrowLeftIcon /> или <MenuIcon />

### <a name="devices-anchor">Устройства</a>
При запуске и в процессе работы приложение будет подключать доступные устройства и устройства перечисленные в конфигурации экранов и добавлять их
в список *Устройства* в **НП**. 

#### <a name="props-anchor">Вкладка *Свойства*</a>
Каждое такое устройство из списка можно выбрать кликнув по нему мышью и в области **РП** будут отображаться свойства выбранного устройства,
часть из которых можно изменять пользователю.

> Изменение свойств устройства относится к "тонкой" настройке, и должна выполнятся квалифицированным специалистом. Рядовым пользователям
при повседневной эксплуатации обычно не требуется изменять эти свойства. Также некоторые свойства такие как *Яркость* управляются
централизованно и не должны изменятся для индивидуальных устройств.

Если свойств достаточно много, то они могут быть сгруппированы по группам.

На панели инструментов вкладки *Свойства* могут быть доступны следующие действия:

<dl>
  <dt> <LoadIcon /> Загрузить свойства из файла.</dt>
  <dd>Загружает сохраненные ранее свойства из указанного файла.</dd>

  <dt> <SaveIcon /> Сохранить выбранные свойства в файл. </dt>
  <dd>Позволяет сохранить все или указанные значения изменяемых свойств в указанный файл.</dd> 

  <dt><RefreshIcon /> Обновить свойства.</dt>
  <dd>Повторно перечитать все свойства с устройства.</dd>

  <dt> <SearchIcon /> [Поиск новых устройств](#find-anchor)</dt>
</dl>

#### <a name="telemetry-anchor">Вкладка *Телеметрия*</a>

Для некоторых устройств/видеоэкранов доступно получение телеметрии от каждого модуля, которая может содержать такие параметры как:
* напряжение
* температура
* версия прошивки
* цветовые координаты
* и т.д.

На панели инструментов вкладки *Телеметрия* доступны следующие действия:

<dl>
  <dt><Filter4Icon /> Задать переменные</dt>
  <dd>Вызвать диалог выбора интересуемых параметров (отображает количество выбранных параметров)</dd>

  <dt><RefreshIcon /> Запустить опрос модулей</dt>
  <dd>Запускается запрос данных телеметрии указанного диапазона экрана</dd>
</dl>

Также используя слайдеры можно задать диапазон опрашиваемых модулей по рядам и строкам (на некоторых устройствах может быть недоступно).

В процессе опроса данные телеметрии будут выдаваться в табличном виде.

> Чем больше запрашиваемых параметров тем дольше производится опрос. Указывайте только интересуемые параметры.

#### <a name="firmware-anchor">Вкладка *Прошивка*</a>

Это экспериментальная возможность и предназначена только для специалистов!

### <a name="output-anchor">Вывод</a>

Если выбрать данный пункт в **НП**, то слева можно увидеть список переключателей тестовых режимов, а справа вкладки с доступными экранами и их параметрами.
Включение/выключение переключателя отображает/скрывает динамический тест на выбранном экране.

На панели инструментов расположены следующие элементы:

<dl>
  <dt><BrightnessAutoIcon /> Автояркость</dt>
  <dd>Включает/выключает режим автояркости для выбранного экрана. Если экран в режиме автояркости, то вы не можете указать индивидуальную яркость, она задается централизованно</dd>

  <dt>**75%** Текущая яркость</dt>
  <dd>Отображает текущую яркость в процентах</dd>

  <dt><Brightness4Icon /> Уменьшить на единицу</dt>
  <dd>Уменьшает яркость на один процентный пункт. Неактивен в режиме автояркость</dd>
  
  <dt>**Слайдер/ползунок**</dt>
  <dd>Задать яркость. Неактивен в режиме автояркость</dd>
  
  <dt><BrightnessHighIcon /> Увеличить на единицу</dt>
  <dd>Увеличивает яркость на один процентный пункт. Неактивен в режиме автояркость</dd>

  <dt><LockIcon /> Разблокировать/заблокировать изменения</dt>
  <dd>Так как свойства экрана меняются достаточно редко, то чтобы настройки не сбились, перед внесением правок необходимо сначала разблокировать свойства экрана</dd>
</dl>

Перед внесением изменений разблокируйте свойства из панели инструментов. После разблокировки можно создать новый экран кликнув на вкладке
по символу <AddToQueue /> или удалить его <CloseIcon />.

Параметры позволяют задать размеры экрана в пикселях, размеры модуля/платы, отступ верхнего левого угла экрана, дисплей на который выводить изображение.
Дисплей можно указать как *основной* или *второстепенный*, либо по его идентификатору. Чтобы узнать идентификатор дисплея его необходимо подключить, тогда его номер
отобразится в списке доступных.

Также важно задать логические или сетевые адреса минихостов если вы хотите централизованно управлять их яркостью и другими параметрами.
Каждый экран должен содержать непересекающийся список адресов. Устройства с указанными адресами будут автоматический обнаружены и включены в список устройств.

Параметр *Коэффициент автояркости* может помочь когда в режиме автояркость используются несколько экранов с различной абсолютной яркостью.
Яркость данного экрана будет рассчитана как общая яркость (в пункте *Автояркость*) умноженная на указанный коэффициент.  Если этот коэффициент равен нулю,
яркость экрана управляется индивидуально и не зависит от общей яркости.

### <a name="autobrightness-anchor">Автояркость</a>

В левой части можно увидеть переключатель, активировав который включается режим автояркости. В этом режиме текущая яркость
рассчитывается на основе данных поступающих от внешнего датчика освещенности. Полученные данные освещенности в люксах отображаются на полукруглой
логарифмической шкале в верхней части окна. Под циферблатом находится таблица соответствия между освещенностью и яркостью.

> Необязательно заполнять всю таблицу, но два крайних значения являются обязательными - это минимальная и максимальная яркость.
Также освещенность и яркость должны возрастать для каждой строки таблицы. Текущий уровень яркости будет вычисляться с помощью интерполяции заданных значений
и лежать в диапазоне от минимальной до максимальной указанной яркости.

Если датчик освещенности отсутствует или неисправен текущая яркость может быть рассчитана по высоте солнца. Для этого вам необходимо задать текущие координаты
GPS. В этом случае также нужно указать два крайних значения в таблице: минимальную и максимальную яркость.

> Обратите внимание, что точные координаты должны быть записаны в десятичной нотации, а не в минутах и секундах!

В правом углу отображается текущая общая яркость и слайдер, которым можно ее изменять, если не включен режим автояркости. Данная яркость будет применена
ко всем экранам, для которых включен режим автояркости (параметр *Коэффициент автояркости* отличен от нуля).

### <a name="overheat-anchor">Защита от перегрева</a>

Активируется переключателем. Защита от перегрева работает следующим образом: через определенный *интервал* времени считывается температура со всех модулей экрана.
Далее, в зависимости от заданного параметра *температура* выбирается максимальное, среднее или медианное значение и, если оно превышает *нижнюю границу* 
температурного диапазона, яркость экрана уменьшается на указанный *шаг понижения*. Если в следующий опрос повышение температуры прекратилось, яркость не меняется.
Если температура продолжает расти или она превысила *верхнюю границу*, яркость понижается еще на один шаг. Если температура опустилась за *нижнюю границу* 
яркость начинает возвращаться к желаемому значению также пошагово.

> Важное замечание. Яркость в интерфейсе приложения - это, так называемая, желаемая яркость. Если включена защита от перегрева, реальная яркость может быть
меньше. Ее реальное значение можно увидеть в свойствах устройства.

### <a name="log-anchor">Журнал</a>

В журнал записывается различная отладочная информация.

На панели инструментов есть кнопка вызова диалога, который позволяет выбрать уровень логирования пересылаемых пакетов и может быть использовано разработчиками.

## <a name="find-anchor">Поиск новых устройств</a>

Диалог *Поиск устройств* можно вызвать кликнув по символу <SearchIcon /> на панели инструментов. С его помощью можно найти устройства, подключенные к сети NIBUS
по RS-485 интерфейсу. Обычно Ваш компьютер должен быть подключен к общей сети посредством устройства Siolynx.

Поиск устройств можно осуществить по *типу* или по *адресу*. Если вы подключены к нескольким сетям, можно выбрать активное *соединение*, либо искать во всех сетях.
Если используется поиск по типу устройства, нужно выбрать искомый тип из выпадающего списка. Если поиск по адресу, то укажите искомый адрес. Если все задано,
можно начать поиск кликнув кнопку с надписью *Начать*. Если поиск затянулся, его можно остановить кликнув на *Остановить*. Процесс поиска сопровождается
движением полоски индикатора выполнения. Также в окне будут появляться обнаруженные устройства. Их можно добавить в общий список устройств кликнув по символу
плюс рядом с устройством.

> Если адрес устройства перечислен в свойствах экрана, его поиск будет осуществляться автоматически.


