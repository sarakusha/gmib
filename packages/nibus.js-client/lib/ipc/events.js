"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventFromString = exports.EventFromStringType = exports.FromStringType = exports.EventV = exports.PortRemovedEventV = exports.PortAddedEventV = exports.PortsEventV = exports.PortArgV = void 0;

require("source-map-support/register");

var t = _interopRequireWildcard(require("io-ts"));

var _ioTsTypes = require("io-ts-types");

var _MibDescription = require("../MibDescription");

var _KnownPorts = require("../session/KnownPorts");

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

/*
 * @license
 * Copyright (c) 2019. OOO Nata-Info
 * @author Andrei Sarakeev <avs@nata-info.ru>
 *
 * This file is part of the "@nata" project.
 * For the full copyright and license information, please view
 * the EULA file that was distributed with this source code.
 */

/* tslint:disable:variable-name */
const eventType = (name, a, b) => t.type({
  event: t.literal(name),
  args: b ? t.tuple([a, b]) : t.tuple([a])
});

const PortArgV = t.type({
  portInfo: _KnownPorts.KnownPortV,
  description: _MibDescription.MibDescriptionV
});
exports.PortArgV = PortArgV;
const PortsEventV = eventType('ports', t.array(PortArgV));
exports.PortsEventV = PortsEventV;
const PortAddedEventV = eventType('add', PortArgV);
exports.PortAddedEventV = PortAddedEventV;
const PortRemovedEventV = eventType('remove', PortArgV);
exports.PortRemovedEventV = PortRemovedEventV;
const EventV = t.taggedUnion('event', [PortsEventV, PortAddedEventV, PortRemovedEventV]);
exports.EventV = EventV;

class FromStringType extends t.Type {
  constructor(name, type) {
    super(name, type.is, (m, c) => {
      const jsonValidation = _ioTsTypes.JSONFromString.validate(m, c);

      if (jsonValidation.isLeft()) {
        return jsonValidation;
      }

      const {
        value
      } = jsonValidation;
      return type.validate(value, c);
    }, JSON.stringify);
  }

}

exports.FromStringType = FromStringType;

class EventFromStringType extends FromStringType {
  constructor() {
    super('EventFromString', EventV);
  }

}

exports.EventFromStringType = EventFromStringType;
const EventFromString = new EventFromStringType();
exports.EventFromString = EventFromString;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pcGMvZXZlbnRzLnRzIl0sIm5hbWVzIjpbImV2ZW50VHlwZSIsIm5hbWUiLCJhIiwiYiIsInQiLCJ0eXBlIiwiZXZlbnQiLCJsaXRlcmFsIiwiYXJncyIsInR1cGxlIiwiUG9ydEFyZ1YiLCJwb3J0SW5mbyIsIktub3duUG9ydFYiLCJkZXNjcmlwdGlvbiIsIk1pYkRlc2NyaXB0aW9uViIsIlBvcnRzRXZlbnRWIiwiYXJyYXkiLCJQb3J0QWRkZWRFdmVudFYiLCJQb3J0UmVtb3ZlZEV2ZW50ViIsIkV2ZW50ViIsInRhZ2dlZFVuaW9uIiwiRnJvbVN0cmluZ1R5cGUiLCJUeXBlIiwiY29uc3RydWN0b3IiLCJpcyIsIm0iLCJjIiwianNvblZhbGlkYXRpb24iLCJKU09ORnJvbVN0cmluZyIsInZhbGlkYXRlIiwiaXNMZWZ0IiwidmFsdWUiLCJKU09OIiwic3RyaW5naWZ5IiwiRXZlbnRGcm9tU3RyaW5nVHlwZSIsIkV2ZW50RnJvbVN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBV0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFmQTs7Ozs7Ozs7OztBQVVBO0FBT0EsTUFBTUEsU0FBUyxHQUFHLENBQW1DQyxJQUFuQyxFQUFpREMsQ0FBakQsRUFBdURDLENBQXZELEtBQWlFQyxDQUFDLENBQUNDLElBQUYsQ0FBTztBQUN4RkMsRUFBQUEsS0FBSyxFQUFFRixDQUFDLENBQUNHLE9BQUYsQ0FBVU4sSUFBVixDQURpRjtBQUV4Rk8sRUFBQUEsSUFBSSxFQUFFTCxDQUFDLEdBQUdDLENBQUMsQ0FBQ0ssS0FBRixDQUFRLENBQUNQLENBQUQsRUFBSUMsQ0FBSixDQUFSLENBQUgsR0FBcUJDLENBQUMsQ0FBQ0ssS0FBRixDQUFRLENBQUNQLENBQUQsQ0FBUjtBQUY0RCxDQUFQLENBQW5GOztBQUtPLE1BQU1RLFFBQVEsR0FBR04sQ0FBQyxDQUFDQyxJQUFGLENBQU87QUFDN0JNLEVBQUFBLFFBQVEsRUFBRUMsc0JBRG1CO0FBRTdCQyxFQUFBQSxXQUFXLEVBQUVDO0FBRmdCLENBQVAsQ0FBakI7O0FBVUEsTUFBTUMsV0FBVyxHQUFHZixTQUFTLENBQUMsT0FBRCxFQUFVSSxDQUFDLENBQUNZLEtBQUYsQ0FBUU4sUUFBUixDQUFWLENBQTdCOztBQUlBLE1BQU1PLGVBQWUsR0FBR2pCLFNBQVMsQ0FBQyxLQUFELEVBQVFVLFFBQVIsQ0FBakM7O0FBSUEsTUFBTVEsaUJBQWlCLEdBQUdsQixTQUFTLENBQUMsUUFBRCxFQUFXVSxRQUFYLENBQW5DOztBQUlBLE1BQU1TLE1BQU0sR0FBR2YsQ0FBQyxDQUFDZ0IsV0FBRixDQUFjLE9BQWQsRUFBdUIsQ0FBQ0wsV0FBRCxFQUFjRSxlQUFkLEVBQStCQyxpQkFBL0IsQ0FBdkIsQ0FBZjs7O0FBSUEsTUFBTUcsY0FBTixTQUFnQ2pCLENBQUMsQ0FBQ2tCLElBQWxDLENBQTJEO0FBQ2hFQyxFQUFBQSxXQUFXLENBQUN0QixJQUFELEVBQWVJLElBQWYsRUFBNEI7QUFDckMsVUFDRUosSUFERixFQUVFSSxJQUFJLENBQUNtQixFQUZQLEVBR0UsQ0FBQ0MsQ0FBRCxFQUFJQyxDQUFKLEtBQVU7QUFDUixZQUFNQyxjQUFjLEdBQUdDLDBCQUFlQyxRQUFmLENBQXdCSixDQUF4QixFQUEyQkMsQ0FBM0IsQ0FBdkI7O0FBQ0EsVUFBSUMsY0FBYyxDQUFDRyxNQUFmLEVBQUosRUFBNkI7QUFDM0IsZUFBT0gsY0FBUDtBQUNEOztBQUNELFlBQU07QUFBRUksUUFBQUE7QUFBRixVQUFZSixjQUFsQjtBQUNBLGFBQU90QixJQUFJLENBQUN3QixRQUFMLENBQWNFLEtBQWQsRUFBcUJMLENBQXJCLENBQVA7QUFDRCxLQVZILEVBV0VNLElBQUksQ0FBQ0MsU0FYUDtBQWFEOztBQWYrRDs7OztBQWtCM0QsTUFBTUMsbUJBQU4sU0FBa0NiLGNBQWxDLENBQXdEO0FBQzdERSxFQUFBQSxXQUFXLEdBQUc7QUFDWixVQUFNLGlCQUFOLEVBQXlCSixNQUF6QjtBQUNEOztBQUg0RDs7O0FBTXhELE1BQU1nQixlQUFlLEdBQUcsSUFBSUQsbUJBQUosRUFBeEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAoYykgMjAxOS4gT09PIE5hdGEtSW5mb1xuICogQGF1dGhvciBBbmRyZWkgU2FyYWtlZXYgPGF2c0BuYXRhLWluZm8ucnU+XG4gKlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIFwiQG5hdGFcIiBwcm9qZWN0LlxuICogRm9yIHRoZSBmdWxsIGNvcHlyaWdodCBhbmQgbGljZW5zZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHZpZXdcbiAqIHRoZSBFVUxBIGZpbGUgdGhhdCB3YXMgZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHNvdXJjZSBjb2RlLlxuICovXG5cbi8qIHRzbGludDpkaXNhYmxlOnZhcmlhYmxlLW5hbWUgKi9cbmltcG9ydCAqIGFzIHQgZnJvbSAnaW8tdHMnO1xuaW1wb3J0IHsgSlNPTkZyb21TdHJpbmcgfSBmcm9tICdpby10cy10eXBlcyc7XG5pbXBvcnQgeyBNaXhlZCB9IGZyb20gJ2lvLXRzL2xpYic7XG5pbXBvcnQgeyBJTWliRGVzY3JpcHRpb24sIE1pYkRlc2NyaXB0aW9uViB9IGZyb20gJy4uL01pYkRlc2NyaXB0aW9uJztcbmltcG9ydCB7IElLbm93blBvcnQsIEtub3duUG9ydFYgfSBmcm9tICcuLi9zZXNzaW9uL0tub3duUG9ydHMnO1xuXG5jb25zdCBldmVudFR5cGUgPSA8QSBleHRlbmRzIE1peGVkLCBCIGV4dGVuZHMgTWl4ZWQ+KG5hbWU6IHN0cmluZywgYTogQSwgYj86IEIpID0+IHQudHlwZSh7XG4gIGV2ZW50OiB0LmxpdGVyYWwobmFtZSksXG4gIGFyZ3M6IGIgPyB0LnR1cGxlKFthLCBiXSkgOiB0LnR1cGxlKFthXSksXG59KTtcblxuZXhwb3J0IGNvbnN0IFBvcnRBcmdWID0gdC50eXBlKHtcbiAgcG9ydEluZm86IEtub3duUG9ydFYsXG4gIGRlc2NyaXB0aW9uOiBNaWJEZXNjcmlwdGlvblYsXG59KTtcblxuZXhwb3J0IGludGVyZmFjZSBJUG9ydEFyZyBleHRlbmRzIHQuVHlwZU9mPHR5cGVvZiBQb3J0QXJnVj4ge1xuICBwb3J0SW5mbzogSUtub3duUG9ydDtcbiAgZGVzY3JpcHRpb246IElNaWJEZXNjcmlwdGlvbjtcbn1cblxuZXhwb3J0IGNvbnN0IFBvcnRzRXZlbnRWID0gZXZlbnRUeXBlKCdwb3J0cycsIHQuYXJyYXkoUG9ydEFyZ1YpKTtcblxuZXhwb3J0IGludGVyZmFjZSBJUG9ydHNFdmVudCBleHRlbmRzIHQuVHlwZU9mPHR5cGVvZiBQb3J0c0V2ZW50Vj4ge31cblxuZXhwb3J0IGNvbnN0IFBvcnRBZGRlZEV2ZW50ViA9IGV2ZW50VHlwZSgnYWRkJywgUG9ydEFyZ1YpO1xuXG5leHBvcnQgaW50ZXJmYWNlIElQb3J0QWRkZWRFdmVudCBleHRlbmRzIHQuVHlwZU9mPHR5cGVvZiBQb3J0QWRkZWRFdmVudFY+IHt9XG5cbmV4cG9ydCBjb25zdCBQb3J0UmVtb3ZlZEV2ZW50ViA9IGV2ZW50VHlwZSgncmVtb3ZlJywgUG9ydEFyZ1YpO1xuXG5leHBvcnQgaW50ZXJmYWNlIElQb3J0UmVtb3ZlZEV2ZW50IGV4dGVuZHMgdC5UeXBlT2Y8dHlwZW9mIFBvcnRSZW1vdmVkRXZlbnRWPiB7fVxuXG5leHBvcnQgY29uc3QgRXZlbnRWID0gdC50YWdnZWRVbmlvbignZXZlbnQnLCBbUG9ydHNFdmVudFYsIFBvcnRBZGRlZEV2ZW50ViwgUG9ydFJlbW92ZWRFdmVudFZdKTtcblxuZXhwb3J0IHR5cGUgRXZlbnQgPSBJUG9ydHNFdmVudCB8IElQb3J0QWRkZWRFdmVudCB8IElQb3J0UmVtb3ZlZEV2ZW50O1xuXG5leHBvcnQgY2xhc3MgRnJvbVN0cmluZ1R5cGU8QT4gZXh0ZW5kcyB0LlR5cGU8QSwgc3RyaW5nLCB1bmtub3duPiB7XG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdHlwZTogTWl4ZWQpIHtcbiAgICBzdXBlcihcbiAgICAgIG5hbWUsXG4gICAgICB0eXBlLmlzLFxuICAgICAgKG0sIGMpID0+IHtcbiAgICAgICAgY29uc3QganNvblZhbGlkYXRpb24gPSBKU09ORnJvbVN0cmluZy52YWxpZGF0ZShtLCBjKTtcbiAgICAgICAgaWYgKGpzb25WYWxpZGF0aW9uLmlzTGVmdCgpKSB7XG4gICAgICAgICAgcmV0dXJuIGpzb25WYWxpZGF0aW9uIGFzIGFueTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSBqc29uVmFsaWRhdGlvbjtcbiAgICAgICAgcmV0dXJuIHR5cGUudmFsaWRhdGUodmFsdWUsIGMpO1xuICAgICAgfSxcbiAgICAgIEpTT04uc3RyaW5naWZ5LFxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV2ZW50RnJvbVN0cmluZ1R5cGUgZXh0ZW5kcyBGcm9tU3RyaW5nVHlwZTxFdmVudD4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcignRXZlbnRGcm9tU3RyaW5nJywgRXZlbnRWKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgRXZlbnRGcm9tU3RyaW5nID0gbmV3IEV2ZW50RnJvbVN0cmluZ1R5cGUoKTtcbiJdfQ==