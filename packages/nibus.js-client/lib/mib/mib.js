"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validJsName = validJsName;
exports.unitConverter = unitConverter;
exports.precisionConverter = precisionConverter;
exports.enumerationConverter = enumerationConverter;
exports.representationConverter = representationConverter;
exports.packed8floatConverter = packed8floatConverter;
exports.getIntSize = getIntSize;
exports.minInclusiveConverter = minInclusiveConverter;
exports.maxInclusiveConverter = maxInclusiveConverter;
exports.convertFrom = exports.convertTo = exports.versionTypeConverter = exports.fixedPointNumber4Converter = exports.percentConverter = exports.booleanConverter = exports.toInt = exports.withValue = void 0;

require("source-map-support/register");

var _printf = _interopRequireDefault(require("printf"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * @license
 * Copyright (c) 2019. OOO Nata-Info
 * @author Andrei Sarakeev <avs@nata-info.ru>
 *
 * This file is part of the "@nata" project.
 * For the full copyright and license information, please view
 * the EULA file that was distributed with this source code.
 */
function validJsName(name) {
  return name.replace(/(_\w)/g, (_, s) => s[1].toUpperCase());
}

const withValue = (value, writable = false) => ({
  value,
  writable,
  configurable: false,
  enumerable: true
});

exports.withValue = withValue;
const hex = /^0X[0-9A-F]+$/i;

const isHex = str => hex.test(str) || parseInt(str, 10).toString(10) !== str.toLowerCase().replace(/^[0 ]+/, '');

const toInt = (value = 0) => {
  if (typeof value === 'number') return value;
  if (typeof value === 'boolean') return value ? 1 : 0;
  if (value === 'true') return 1;
  if (value === 'false') return 0;
  return parseInt(value, isHex(value) ? 16 : 10);
};

exports.toInt = toInt;

function unitConverter(unit) {
  const fromRe = new RegExp(`(\\s*${unit}\\s*)$`, 'i');
  return {
    from: value => typeof value === 'string' ? value.replace(fromRe, '') : value,
    to: value => value != null ? `${value}${unit}` : value
  };
}

function precisionConverter(precision) {
  const format = `%.${precision}f`;
  return {
    from: value => typeof value === 'string' ? parseFloat(value) : value,
    to: value => typeof value === 'number' ? (0, _printf.default)(format, value) : value
  };
}

function enumerationConverter(enumerationValues) {
  const from = {};
  const to = {};
  const keys = Reflect.ownKeys(enumerationValues);
  keys.forEach(key => {
    const value = enumerationValues[key];
    const index = toInt(key);
    from[value.annotation] = index;
    to[String(index)] = value.annotation;
  }); // console.log('from %o, to %o', from, to);

  return {
    from: value => {
      if (Reflect.has(from, String(value))) {
        return from[String(value)];
      }

      const simple = toInt(value);
      return Number.isNaN(simple) ? value : simple;
    },
    to: value => {
      let index = toInt(value);
      if (Number.isNaN(index)) index = String(value);
      return Reflect.has(to, String(index)) ? to[String(index)] : value;
    }
  };
}

const yes = /^\s*(yes|on|true|1|да)\s*$/i;
const no = /^\s*(no|off|false|0|нет)\s*$/i;
const booleanConverter = {
  from: value => {
    if (typeof value === 'string') {
      if (yes.test(value)) {
        return true;
      }

      if (no.test(value)) {
        return false;
      }
    }

    return value;
  },
  to: value => {
    if (typeof value === 'boolean') {
      return value ? 'Да' : 'Нет';
    }

    return value;
  }
};
exports.booleanConverter = booleanConverter;
const percentConverter = {
  from: value => typeof value === 'number' ? Math.max(Math.min(Math.round(value * 255 / 100), 255), 0) : value,
  to: value => typeof value === 'number' ? Math.max(Math.min(Math.round(value * 100 / 255), 100), 0) : value
};
exports.percentConverter = percentConverter;

function representationConverter(format, size) {
  let from;
  let to;
  let fmt; // fromFn = toFn = function (value) { return value; };

  switch (format) {
    case '%b':
    case '%B':
      fmt = `%0${size * 8}s`;

      from = value => typeof value === 'string' ? parseInt(value, 2) : value;

      to = value => typeof value === 'number' ? (0, _printf.default)(fmt, value.toString(2)) : value;

      break;

    case '%x':
    case '%X':
      fmt = `%0${size}s`;

      from = value => typeof value === 'string' ? parseInt(value, 16) : value;

      to = value => typeof value === 'number' ? (0, _printf.default)(fmt, value.toString(16)) : value;

      break;

    default:
      from = value => value;

      to = from;
  }

  return {
    from,
    to
  };
}

function packed8floatConverter(subtype) {
  let delta = 0;

  if (subtype.appinfo && subtype.appinfo.zero) {
    delta = parseFloat(subtype.appinfo.zero) || 0;
  }

  return {
    from: value => {
      const val = typeof value === 'string' ? parseFloat(value) : value;
      return typeof val === 'number' ? Math.floor((val - delta) * 100) & 0xFF : val;
    },
    to: value => typeof value === 'number' ? value / 100 + delta : value
  };
}

const fixedPointNumber4Converter = {
  from: value => {
    const val = typeof value === 'string' ? parseFloat(value) : value;

    if (typeof val !== 'number') {
      return val;
    }

    const dec = Math.round(val * 1000) % 1000;
    const hi = (Math.floor(val) << 4) + Math.floor(dec / 100) & 0xFF;
    const low = dec % 10 + (Math.floor(dec / 10) % 10 << 4) & 0xFF;
    return hi << 8 | low;
  },
  to: value => {
    if (typeof value !== 'number') {
      return value;
    }

    const hi = value >> 8 & 0xFF;
    const low = value & 0xFF;
    const dec = (hi & 0xF) * 100 + (low >> 4) * 10 + (low & 0xF);
    return (hi >> 4) + dec / 1000;
  }
};
exports.fixedPointNumber4Converter = fixedPointNumber4Converter;
const versionTypeConverter = {
  from: () => {
    throw new Error('versionType is readonly property');
  },
  to: value => typeof value === 'number' ? `${value >> 8 & 0xFF}.${value & 0xFF} [0x${(value >>> 16).toString(16)}]` : value
};
exports.versionTypeConverter = versionTypeConverter;

function getIntSize(type) {
  switch (type) {
    case 'xs:NMTOKEN':
    case 'xs:unsignedByte':
    case 'xs:byte':
      return 1;

    case 'xs:short':
    case 'xs:unsignedShort':
      return 2;

    case 'xs:int':
    case 'xs:unsignedInt':
      return 4;

    case 'xs:long':
    case 'xs:unsignedLong':
      return 8;
  }
}

function minInclusiveConverter(min) {
  return {
    from: value => typeof value === 'number' ? Math.max(value, min) : value,
    to: value => value
  };
}

function maxInclusiveConverter(max) {
  return {
    from: value => typeof value === 'number' ? Math.min(value, max) : value,
    to: value => value
  };
}

const convertTo = converters => value => converters.reduceRight((result, converter) => result !== undefined && converter.to(result), value);

exports.convertTo = convertTo;

const convertFrom = converters => value => converters.reduce((present, converter) => converter.from(present), value);

exports.convertFrom = convertFrom;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWIvbWliLnRzIl0sIm5hbWVzIjpbInZhbGlkSnNOYW1lIiwibmFtZSIsInJlcGxhY2UiLCJfIiwicyIsInRvVXBwZXJDYXNlIiwid2l0aFZhbHVlIiwidmFsdWUiLCJ3cml0YWJsZSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJoZXgiLCJpc0hleCIsInN0ciIsInRlc3QiLCJwYXJzZUludCIsInRvU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJ0b0ludCIsInVuaXRDb252ZXJ0ZXIiLCJ1bml0IiwiZnJvbVJlIiwiUmVnRXhwIiwiZnJvbSIsInRvIiwicHJlY2lzaW9uQ29udmVydGVyIiwicHJlY2lzaW9uIiwiZm9ybWF0IiwicGFyc2VGbG9hdCIsImVudW1lcmF0aW9uQ29udmVydGVyIiwiZW51bWVyYXRpb25WYWx1ZXMiLCJrZXlzIiwiUmVmbGVjdCIsIm93bktleXMiLCJmb3JFYWNoIiwia2V5IiwiaW5kZXgiLCJhbm5vdGF0aW9uIiwiU3RyaW5nIiwiaGFzIiwic2ltcGxlIiwiTnVtYmVyIiwiaXNOYU4iLCJ5ZXMiLCJubyIsImJvb2xlYW5Db252ZXJ0ZXIiLCJwZXJjZW50Q29udmVydGVyIiwiTWF0aCIsIm1heCIsIm1pbiIsInJvdW5kIiwicmVwcmVzZW50YXRpb25Db252ZXJ0ZXIiLCJzaXplIiwiZm10IiwicGFja2VkOGZsb2F0Q29udmVydGVyIiwic3VidHlwZSIsImRlbHRhIiwiYXBwaW5mbyIsInplcm8iLCJ2YWwiLCJmbG9vciIsImZpeGVkUG9pbnROdW1iZXI0Q29udmVydGVyIiwiZGVjIiwiaGkiLCJsb3ciLCJ2ZXJzaW9uVHlwZUNvbnZlcnRlciIsIkVycm9yIiwiZ2V0SW50U2l6ZSIsInR5cGUiLCJtaW5JbmNsdXNpdmVDb252ZXJ0ZXIiLCJtYXhJbmNsdXNpdmVDb252ZXJ0ZXIiLCJjb252ZXJ0VG8iLCJjb252ZXJ0ZXJzIiwicmVkdWNlUmlnaHQiLCJyZXN1bHQiLCJjb252ZXJ0ZXIiLCJ1bmRlZmluZWQi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RCxJQUErQmpFLEtBQUQsSUFDckRpRSxVQUFVLENBQUNDLFdBQVgsQ0FDRSxDQUFDQyxNQUFELEVBQVNDLFNBQVQsS0FBdUJELE1BQU0sS0FBS0UsU0FBWCxJQUF3QkQsU0FBUyxDQUFDbkQsRUFBVixDQUFha0QsTUFBYixDQURqRCxFQUVFbkUsS0FGRixDQURLOzs7O0FBTUEsTUFBTXNFLFdBQVcsR0FBSUwsVUFBRCxJQUErQmpFLEtBQUQsSUFDdkRpRSxVQUFVLENBQUNNLE1BQVgsQ0FBa0IsQ0FBQ0MsT0FBRCxFQUFVSixTQUFWLEtBQXdCQSxTQUFTLENBQUNwRCxJQUFWLENBQWV3RCxPQUFmLENBQTFDLEVBQW1FeEUsS0FBbkUsQ0FESyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IChjKSAyMDE5LiBPT08gTmF0YS1JbmZvXG4gKiBAYXV0aG9yIEFuZHJlaSBTYXJha2VldiA8YXZzQG5hdGEtaW5mby5ydT5cbiAqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgXCJAbmF0YVwiIHByb2plY3QuXG4gKiBGb3IgdGhlIGZ1bGwgY29weXJpZ2h0IGFuZCBsaWNlbnNlIGluZm9ybWF0aW9uLCBwbGVhc2Ugdmlld1xuICogdGhlIEVVTEEgZmlsZSB0aGF0IHdhcyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgc291cmNlIGNvZGUuXG4gKi9cblxuaW1wb3J0IHByaW50ZiBmcm9tICdwcmludGYnO1xuaW1wb3J0IHsgSU1pYlR5cGUgfSBmcm9tICcuL2RldmljZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRKc05hbWUobmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoLyhfXFx3KS9nLCAoXywgcykgPT4gc1sxXS50b1VwcGVyQ2FzZSgpKTtcbn1cblxuZXhwb3J0IGNvbnN0IHdpdGhWYWx1ZSA9ICh2YWx1ZTogYW55LCB3cml0YWJsZSA9IGZhbHNlKTogUHJvcGVydHlEZXNjcmlwdG9yID0+ICh7XG4gIHZhbHVlLFxuICB3cml0YWJsZSxcbiAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgZW51bWVyYWJsZTogdHJ1ZSxcbn0pO1xuY29uc3QgaGV4ID0gL14wWFswLTlBLUZdKyQvaTtcbmNvbnN0IGlzSGV4ID0gKHN0cjogc3RyaW5nKSA9PiBoZXgudGVzdChzdHIpXG4gIHx8IHBhcnNlSW50KHN0ciwgMTApLnRvU3RyaW5nKDEwKSAhPT0gc3RyLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXlswIF0rLywgJycpO1xuXG5leHBvcnQgY29uc3QgdG9JbnQgPSAodmFsdWU6IHN0cmluZyB8IGJvb2xlYW4gfCBudW1iZXIgPSAwKTogbnVtYmVyID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHJldHVybiB2YWx1ZTtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSByZXR1cm4gdmFsdWUgPyAxIDogMDtcbiAgaWYgKHZhbHVlID09PSAndHJ1ZScpIHJldHVybiAxO1xuICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHJldHVybiAwO1xuICByZXR1cm4gcGFyc2VJbnQodmFsdWUsIGlzSGV4KHZhbHVlKSA/IDE2IDogMTApO1xufTtcblxudHlwZSBSZXN1bHRUeXBlID0gc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHVuZGVmaW5lZDtcbnR5cGUgUHJlc2VudFR5cGUgPSBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgdW5kZWZpbmVkO1xuXG5leHBvcnQgaW50ZXJmYWNlIElDb252ZXJ0ZXIge1xuICBmcm9tOiAodmFsdWU6IFByZXNlbnRUeXBlKSA9PiBSZXN1bHRUeXBlO1xuICB0bzogKHZhbHVlOiBSZXN1bHRUeXBlKSA9PiBQcmVzZW50VHlwZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuaXRDb252ZXJ0ZXIodW5pdDogc3RyaW5nKTogSUNvbnZlcnRlciB7XG4gIGNvbnN0IGZyb21SZSA9IG5ldyBSZWdFeHAoYChcXFxccyoke3VuaXR9XFxcXHMqKSRgLCAnaScpO1xuICByZXR1cm4ge1xuICAgIGZyb206IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB2YWx1ZS5yZXBsYWNlKGZyb21SZSwgJycpIDogdmFsdWUsXG4gICAgdG86IHZhbHVlID0+IHZhbHVlICE9IG51bGwgPyBgJHt2YWx1ZX0ke3VuaXR9YCA6IHZhbHVlLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlY2lzaW9uQ29udmVydGVyKHByZWNpc2lvbjogc3RyaW5nKTogSUNvbnZlcnRlciB7XG4gIGNvbnN0IGZvcm1hdCA9IGAlLiR7cHJlY2lzaW9ufWZgO1xuICByZXR1cm4ge1xuICAgIGZyb206IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBwYXJzZUZsb2F0KHZhbHVlKSA6IHZhbHVlLFxuICAgIHRvOiB2YWx1ZSA9PiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gcHJpbnRmKGZvcm1hdCwgdmFsdWUpIDogdmFsdWUsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbnVtZXJhdGlvbkNvbnZlcnRlcihlbnVtZXJhdGlvblZhbHVlczogSU1pYlR5cGVbJ2VudW1lcmF0aW9uJ10pOiBJQ29udmVydGVyIHtcbiAgY29uc3QgZnJvbTogYW55ID0ge307XG4gIGNvbnN0IHRvOiBhbnkgPSB7fTtcbiAgY29uc3Qga2V5cyA9IFJlZmxlY3Qub3duS2V5cyhlbnVtZXJhdGlvblZhbHVlcyEpIGFzIHN0cmluZ1tdO1xuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gZW51bWVyYXRpb25WYWx1ZXMhW2tleV07XG4gICAgY29uc3QgaW5kZXggPSB0b0ludChrZXkpO1xuICAgIGZyb21bdmFsdWUuYW5ub3RhdGlvbl0gPSBpbmRleDtcbiAgICB0b1tTdHJpbmcoaW5kZXgpXSA9IHZhbHVlLmFubm90YXRpb247XG4gIH0pO1xuICAvLyBjb25zb2xlLmxvZygnZnJvbSAlbywgdG8gJW8nLCBmcm9tLCB0byk7XG4gIHJldHVybiB7XG4gICAgZnJvbTogKHZhbHVlKSA9PiB7XG4gICAgICBpZiAoUmVmbGVjdC5oYXMoZnJvbSwgU3RyaW5nKHZhbHVlKSkpIHtcbiAgICAgICAgcmV0dXJuIGZyb21bU3RyaW5nKHZhbHVlKV07XG4gICAgICB9XG4gICAgICBjb25zdCBzaW1wbGUgPSB0b0ludCh2YWx1ZSk7XG4gICAgICByZXR1cm4gTnVtYmVyLmlzTmFOKHNpbXBsZSkgPyB2YWx1ZSA6IHNpbXBsZTtcbiAgICB9LFxuICAgIHRvOiAodmFsdWUpID0+IHtcbiAgICAgIGxldCBpbmRleDogbnVtYmVyIHwgc3RyaW5nID0gdG9JbnQodmFsdWUpO1xuICAgICAgaWYgKE51bWJlci5pc05hTihpbmRleCkpIGluZGV4ID0gU3RyaW5nKHZhbHVlKTtcbiAgICAgIHJldHVybiBSZWZsZWN0Lmhhcyh0bywgU3RyaW5nKGluZGV4KSkgPyB0b1tTdHJpbmcoaW5kZXgpXSA6IHZhbHVlO1xuICAgIH0sXG4gIH07XG59XG5cbmNvbnN0IHllcyA9IC9eXFxzKih5ZXN8b258dHJ1ZXwxfNC00LApXFxzKiQvaTtcbmNvbnN0IG5vID0gL15cXHMqKG5vfG9mZnxmYWxzZXwwfNC90LXRgilcXHMqJC9pO1xuZXhwb3J0IGNvbnN0IGJvb2xlYW5Db252ZXJ0ZXI6IElDb252ZXJ0ZXIgPSB7XG4gIGZyb206ICh2YWx1ZSkgPT4ge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoeWVzLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKG5vLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9LFxuICB0bzogKHZhbHVlKSA9PiB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPyAn0JTQsCcgOiAn0J3QtdGCJztcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IHBlcmNlbnRDb252ZXJ0ZXI6IElDb252ZXJ0ZXIgPSB7XG4gIGZyb206IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyBNYXRoLm1heChNYXRoLm1pbihcbiAgICBNYXRoLnJvdW5kKHZhbHVlICogMjU1IC8gMTAwKSxcbiAgICAyNTUsXG4gICksIDApIDogdmFsdWUsXG4gIHRvOiB2YWx1ZSA9PiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gTWF0aC5tYXgoXG4gICAgTWF0aC5taW4oTWF0aC5yb3VuZCh2YWx1ZSAqIDEwMCAvIDI1NSksIDEwMCksXG4gICAgMCxcbiAgKSA6IHZhbHVlLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlcHJlc2VudGF0aW9uQ29udmVydGVyKGZvcm1hdDogc3RyaW5nLCBzaXplOiBudW1iZXIpOiBJQ29udmVydGVyIHtcbiAgbGV0IGZyb206IElDb252ZXJ0ZXJbJ2Zyb20nXTtcbiAgbGV0IHRvOiBJQ29udmVydGVyWyd0byddO1xuICBsZXQgZm10OiBzdHJpbmc7XG4gIC8vIGZyb21GbiA9IHRvRm4gPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9O1xuXG4gIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgY2FzZSAnJWInOlxuICAgIGNhc2UgJyVCJzpcbiAgICAgIGZtdCA9IGAlMCR7c2l6ZSAqIDh9c2A7XG4gICAgICBmcm9tID0gdmFsdWUgPT4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHBhcnNlSW50KHZhbHVlLCAyKSA6IHZhbHVlO1xuICAgICAgdG8gPSB2YWx1ZSA9PiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gcHJpbnRmKGZtdCwgdmFsdWUudG9TdHJpbmcoMikpIDogdmFsdWU7XG4gICAgICBicmVhaztcbiAgICBjYXNlICcleCc6XG4gICAgY2FzZSAnJVgnOlxuICAgICAgZm10ID0gYCUwJHtzaXplfXNgO1xuICAgICAgZnJvbSA9IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBwYXJzZUludCh2YWx1ZSwgMTYpIDogdmFsdWU7XG4gICAgICB0byA9IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyBwcmludGYoZm10LCB2YWx1ZS50b1N0cmluZygxNikpIDogdmFsdWU7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgZnJvbSA9IHZhbHVlID0+IHZhbHVlO1xuICAgICAgdG8gPSBmcm9tO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBmcm9tLFxuICAgIHRvLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFja2VkOGZsb2F0Q29udmVydGVyKHN1YnR5cGU6IElNaWJUeXBlKTogSUNvbnZlcnRlciB7XG4gIGxldCBkZWx0YSA9IDA7XG4gIGlmIChzdWJ0eXBlLmFwcGluZm8gJiYgc3VidHlwZS5hcHBpbmZvLnplcm8pIHtcbiAgICBkZWx0YSA9IHBhcnNlRmxvYXQoc3VidHlwZS5hcHBpbmZvLnplcm8pIHx8IDA7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBmcm9tOiAodmFsdWUpID0+IHtcbiAgICAgIGNvbnN0IHZhbCA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBwYXJzZUZsb2F0KHZhbHVlKSA6IHZhbHVlO1xuICAgICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdudW1iZXInID8gTWF0aC5mbG9vcigodmFsIC0gZGVsdGEpICogMTAwKSAmIDB4RkYgOiB2YWw7XG4gICAgfSxcbiAgICB0bzogdmFsdWUgPT4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyA/IHZhbHVlIC8gMTAwICsgZGVsdGEgOiB2YWx1ZSxcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IGZpeGVkUG9pbnROdW1iZXI0Q29udmVydGVyOiBJQ29udmVydGVyID0ge1xuICBmcm9tOiAodmFsdWUpID0+IHtcbiAgICBjb25zdCB2YWwgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gcGFyc2VGbG9hdCh2YWx1ZSkgOiB2YWx1ZTtcbiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIGNvbnN0IGRlYyA9IE1hdGgucm91bmQodmFsICogMTAwMCkgJSAxMDAwO1xuICAgIGNvbnN0IGhpID0gKChNYXRoLmZsb29yKHZhbCkgPDwgNCkgKyBNYXRoLmZsb29yKGRlYyAvIDEwMCkpICYgMHhGRjtcbiAgICBjb25zdCBsb3cgPSAoZGVjICUgMTAgKyAoKE1hdGguZmxvb3IoZGVjIC8gMTApICUgMTApIDw8IDQpKSAmIDB4RkY7XG4gICAgcmV0dXJuIChoaSA8PCA4KSB8IGxvdztcbiAgfSxcbiAgdG86ICh2YWx1ZSkgPT4ge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNvbnN0IGhpID0gKHZhbHVlID4+IDgpICYgMHhGRjtcbiAgICBjb25zdCBsb3cgPSB2YWx1ZSAmIDB4RkY7XG4gICAgY29uc3QgZGVjID0gKGhpICYgMHhGKSAqIDEwMCArIChsb3cgPj4gNCkgKiAxMCArIChsb3cgJiAweEYpO1xuICAgIHJldHVybiAoaGkgPj4gNCkgKyBkZWMgLyAxMDAwO1xuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IHZlcnNpb25UeXBlQ29udmVydGVyOiBJQ29udmVydGVyID0ge1xuICBmcm9tOiAoKSA9PiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd2ZXJzaW9uVHlwZSBpcyByZWFkb25seSBwcm9wZXJ0eScpO1xuICB9LFxuICB0bzogdmFsdWUgPT4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJ1xuICAgID8gYCR7KHZhbHVlID4+IDgpICYgMHhGRn0uJHt2YWx1ZSAmIDB4RkZ9IFsweCR7KHZhbHVlID4+PiAxNikudG9TdHJpbmcoMTYpfV1gXG4gICAgOiB2YWx1ZSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbnRTaXplKHR5cGU6IHN0cmluZykge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICd4czpOTVRPS0VOJzpcbiAgICBjYXNlICd4czp1bnNpZ25lZEJ5dGUnOlxuICAgIGNhc2UgJ3hzOmJ5dGUnOlxuICAgICAgcmV0dXJuIDE7XG4gICAgY2FzZSAneHM6c2hvcnQnOlxuICAgIGNhc2UgJ3hzOnVuc2lnbmVkU2hvcnQnOlxuICAgICAgcmV0dXJuIDI7XG4gICAgY2FzZSAneHM6aW50JzpcbiAgICBjYXNlICd4czp1bnNpZ25lZEludCc6XG4gICAgICByZXR1cm4gNDtcbiAgICBjYXNlICd4czpsb25nJzpcbiAgICBjYXNlICd4czp1bnNpZ25lZExvbmcnOlxuICAgICAgcmV0dXJuIDg7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pbkluY2x1c2l2ZUNvbnZlcnRlcihtaW46IG51bWJlcik6IElDb252ZXJ0ZXIge1xuICByZXR1cm4ge1xuICAgIGZyb206IHZhbHVlID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyAgTWF0aC5tYXgodmFsdWUsIG1pbikgOiB2YWx1ZSxcbiAgICB0bzogdmFsdWUgPT4gdmFsdWUsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXhJbmNsdXNpdmVDb252ZXJ0ZXIobWF4OiBudW1iZXIpOiBJQ29udmVydGVyIHtcbiAgcmV0dXJuIHtcbiAgICBmcm9tOiB2YWx1ZSA9PiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gTWF0aC5taW4odmFsdWUsIG1heCkgOiB2YWx1ZSxcbiAgICB0bzogdmFsdWUgPT4gdmFsdWUsXG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBjb252ZXJ0VG8gPSAoY29udmVydGVyczogSUNvbnZlcnRlcltdKSA9PiAodmFsdWU6IFJlc3VsdFR5cGUpID0+XG4gIGNvbnZlcnRlcnMucmVkdWNlUmlnaHQoXG4gICAgKHJlc3VsdCwgY29udmVydGVyKSA9PiByZXN1bHQgIT09IHVuZGVmaW5lZCAmJiBjb252ZXJ0ZXIudG8ocmVzdWx0KSxcbiAgICB2YWx1ZSxcbiAgKTtcblxuZXhwb3J0IGNvbnN0IGNvbnZlcnRGcm9tID0gKGNvbnZlcnRlcnM6IElDb252ZXJ0ZXJbXSkgPT4gKHZhbHVlOiBQcmVzZW50VHlwZSkgPT5cbiAgY29udmVydGVycy5yZWR1Y2UoKHByZXNlbnQsIGNvbnZlcnRlcikgPT4gY29udmVydGVyLmZyb20ocHJlc2VudCksIHZhbHVlKTtcbiJdfQ==