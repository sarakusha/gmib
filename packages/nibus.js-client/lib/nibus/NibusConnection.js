"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.getNibusTimeout = exports.setNibusTimeout = exports.MINIHOST_TYPE = void 0;

require("source-map-support/register");

var _PathReporter = require("io-ts/lib/PathReporter");

var _lodash = _interopRequireDefault(require("lodash"));

var _net = require("net");

var _xpipe = _interopRequireDefault(require("xpipe"));

var _events = require("events");

var _debug = _interopRequireDefault(require("debug"));

var _errors = require("../errors");

var _ipc = require("../ipc");

var _nms = require("../nms");

var _NmsServiceType = _interopRequireDefault(require("../nms/NmsServiceType"));

var _sarp = require("../sarp");

var _MibDescription = require("../MibDescription");

var _NibusEncoder = _interopRequireDefault(require("./NibusEncoder"));

var _NibusDecoder = _interopRequireDefault(require("./NibusDecoder"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const MINIHOST_TYPE = 0xabc6;
exports.MINIHOST_TYPE = MINIHOST_TYPE;
const FIRMWARE_VERSION_ID = 0x85;
const VERSION_ID = 2;
const debug = (0, _debug.default)('nibus:connection');
let NIBUS_TIMEOUT = 1000;

const setNibusTimeout = timeout => {
  NIBUS_TIMEOUT = timeout;
};

exports.setNibusTimeout = setNibusTimeout;

const getNibusTimeout = () => NIBUS_TIMEOUT;

exports.getNibusTimeout = getNibusTimeout;

class WaitedNmsDatagram {
  constructor(req, resolve, reject, callback) {
    this.req = req;

    _defineProperty(this, "resolve", void 0);

    let timer;
    let counter = req.service !== _NmsServiceType.default.Read ? 1 : Math.floor(req.nms.length / 3) + 1;
    const datagrams = [];

    const timeout = () => {
      callback(this);
      datagrams.length === 0 ? reject(new _errors.TimeoutError(`Timeout error on ${req.destination} while ${_NmsServiceType.default[req.service]}`)) : resolve(datagrams);
    };

    const restart = (step = 1) => {
      counter -= step;
      clearTimeout(timer);

      if (counter > 0) {
        timer = setTimeout(timeout, req.timeout || NIBUS_TIMEOUT);
      } else if (counter === 0) {
        callback(this);
      }

      return counter === 0;
    };

    restart(0);

    this.resolve = datagram => {
      datagrams.push(datagram);

      if (restart()) {
        resolve(datagrams.length > 1 ? datagrams : datagram);
      }
    };
  }

}

class NibusConnection extends _events.EventEmitter {
  constructor(path, _description) {
    super();
    this.path = path;

    _defineProperty(this, "socket", void 0);

    _defineProperty(this, "encoder", new _NibusEncoder.default());

    _defineProperty(this, "decoder", new _NibusDecoder.default());

    _defineProperty(this, "ready", Promise.resolve());

    _defineProperty(this, "closed", false);

    _defineProperty(this, "waited", []);

    _defineProperty(this, "description", void 0);

    _defineProperty(this, "stopWaiting", waited => _lodash.default.remove(this.waited, waited));

    _defineProperty(this, "onDatagram", datagram => {
      let showLog = true;

      if (datagram instanceof _nms.NmsDatagram) {
        if (datagram.isResponse) {
          const resp = this.waited.find(item => datagram.isResponseFor(item.req));

          if (resp) {
            resp.resolve(datagram);
            showLog = false;
          }
        }

        this.emit('nms', datagram);
      } else if (datagram instanceof _sarp.SarpDatagram) {
        this.emit('sarp', datagram);
        showLog = false;
      }

      showLog && debug(`datagram received`, JSON.stringify(datagram.toJSON()));
    });

    _defineProperty(this, "close", () => {
      if (this.closed) return;
      const {
        path,
        description
      } = this;
      debug(`close connection on ${path} (${description.category})`);
      this.closed = true;
      this.encoder.end();
      this.decoder.removeAllListeners('data');
      this.socket.destroy();
      this.emit('close');
    });

    const validate = _MibDescription.MibDescriptionV.decode(_description);

    if (validate.isLeft()) {
      const msg = _PathReporter.PathReporter.report(validate).join('\n');

      debug('<error>', msg);
      throw new TypeError(msg);
    }

    this.description = validate.value;
    this.socket = (0, _net.connect)(_xpipe.default.eq((0, _ipc.getSocketPath)(path)));
    this.socket.pipe(this.decoder);
    this.encoder.pipe(this.socket);
    this.decoder.on('data', this.onDatagram);
    this.socket.once('close', this.close);
    debug(`new connection on ${path} (${_description.category})`);
  }

  sendDatagram(datagram) {
    // debug('write datagram from ', datagram.source.toString());
    const {
      encoder,
      stopWaiting,
      waited,
      closed
    } = this;
    return new Promise((resolve, reject) => {
      this.ready = this.ready.finally(async () => {
        if (closed) return reject(new Error('Closed'));

        if (!encoder.write(datagram)) {
          await new Promise(cb => encoder.once('drain', cb));
        }

        if (!(datagram instanceof _nms.NmsDatagram) || datagram.notReply) {
          return resolve();
        }

        waited.push(new WaitedNmsDatagram(datagram, resolve, reject, stopWaiting));
      });
    });
  }

  ping(address) {
    debug(`ping [${address.toString()}] ${this.path}`);
    const now = Date.now();
    return this.sendDatagram((0, _nms.createNmsRead)(address, VERSION_ID)).then(datagram => {
      return Reflect.getOwnMetadata('timeStamp', datagram) - now;
    }).catch(() => {
      // debug(`ping [${address}] failed ${reson}`);
      return -1;
    });
  }

  findByType(type = MINIHOST_TYPE) {
    debug(`findByType ${type} on ${this.path} (${this.description.category})`);
    const sarp = (0, _sarp.createSarp)(_sarp.SarpQueryType.ByType, [0, 0, 0, type >> 8 & 0xFF, type & 0xFF]);
    return this.sendDatagram(sarp);
  }

  async getVersion(address) {
    const nmsRead = (0, _nms.createNmsRead)(address, VERSION_ID);

    try {
      const {
        value,
        status
      } = await this.sendDatagram(nmsRead);

      if (status !== 0) {
        debug('<error>', status);
        return [];
      }

      const version = value & 0xFFFF;
      const type = value >>> 16;
      return [version, type];
    } catch (err) {
      debug('<error>', err.message || err);
      return [];
    }
  }

}

var _default = NibusConnection;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9uaWJ1cy9OaWJ1c0Nvbm5lY3Rpb24udHMiXSwibmFtZXMiOlsiTUlOSUhPU1RfVFlQRSIsIkZJUk1XQVJFX1ZFUlNJT05fSUQiLCJWRVJTSU9OX0lEIiwiZGVidWciLCJOSUJVU19USU1FT1VUIiwic2V0TmlidXNUaW1lb3V0IiwidGltZW91dCIsImdldE5pYnVzVGltZW91dCIsIldhaXRlZE5tc0RhdGFncmFtIiwiY29uc3RydWN0b3IiLCJyZXEiLCJyZXNvbHZlIiwicmVqZWN0IiwiY2FsbGJhY2siLCJ0aW1lciIsImNvdW50ZXIiLCJzZXJ2aWNlIiwiTm1zU2VydmljZVR5cGUiLCJSZWFkIiwiTWF0aCIsImZsb29yIiwibm1zIiwibGVuZ3RoIiwiZGF0YWdyYW1zIiwiVGltZW91dEVycm9yIiwiZGVzdGluYXRpb24iLCJyZXN0YXJ0Iiwic3RlcCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJkYXRhZ3JhbSIsInB1c2giLCJOaWJ1c0Nvbm5lY3Rpb24iLCJFdmVudEVtaXR0ZXIiLCJwYXRoIiwiZGVzY3JpcHRpb24iLCJOaWJ1c0VuY29kZXIiLCJOaWJ1c0RlY29kZXIiLCJQcm9taXNlIiwid2FpdGVkIiwiXyIsInJlbW92ZSIsInNob3dMb2ciLCJObXNEYXRhZ3JhbSIsImlzUmVzcG9uc2UiLCJyZXNwIiwiZmluZCIsIml0ZW0iLCJpc1Jlc3BvbnNlRm9yIiwiZW1pdCIsIlNhcnBEYXRhZ3JhbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b0pTT04iLCJjbG9zZWQiLCJjYXRlZ29yeSIsImVuY29kZXIiLCJlbmQiLCJkZWNvZGVyIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwic29ja2V0IiwiZGVzdHJveSIsInZhbGlkYXRlIiwiTWliRGVzY3JpcHRpb25WIiwiZGVjb2RlIiwiaXNMZWZ0IiwibXNnIiwiUGF0aFJlcG9ydGVyIiwicmVwb3J0Iiwiam9pbiIsIlR5cGVFcnJvciIsInZhbHVlIiwieHBpcGUiLCJlcSIsInBpcGUiLCJvbiIsIm9uRGF0YWdyYW0iLCJvbmNlIiwiY2xvc2UiLCJzZW5kRGF0YWdyYW0iLCJzdG9wV2FpdGluZyIsInJlYWR5IiwiZmluYWxseSIsIkVycm9yIiwid3JpdGUiLCJjYiIsIm5vdFJlcGx5IiwicGluZyIsImFkZHJlc3MiLCJ0b1N0cmluZyIsIm5vdyIsIkRhdGUiLCJ0aGVuIiwiUmVmbGVjdCIsImdldE93bk1ldGFkYXRhIiwiY2F0Y2giLCJmaW5kQnlUeXBlIiwidHlwZSIsInNhcnAiLCJTYXJwUXVlcnlUeXBlIiwiQnlUeXBlIiwiZ2V0VmVyc2lvbiIsIm5tc1JlYWQiLCJzdGF0dXMiLCJ2ZXJzaW9uIiwiZXJyIiwibWVzc2FnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBVUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRUE7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7OztBQUVPLE1BQU1BLGFBQWEsR0FBRyxNQUF0Qjs7QUFDUCxNQUFNQyxtQkFBbUIsR0FBRyxJQUE1QjtBQUNBLE1BQU1DLFVBQVUsR0FBRyxDQUFuQjtBQUVBLE1BQU1DLEtBQUssR0FBRyxvQkFBYSxrQkFBYixDQUFkO0FBQ0EsSUFBSUMsYUFBYSxHQUFHLElBQXBCOztBQUVPLE1BQU1DLGVBQWUsR0FBSUMsT0FBRCxJQUFxQjtBQUNsREYsRUFBQUEsYUFBYSxHQUFHRSxPQUFoQjtBQUNELENBRk07Ozs7QUFJQSxNQUFNQyxlQUFlLEdBQUcsTUFBTUgsYUFBOUI7Ozs7QUFFUCxNQUFNSSxpQkFBTixDQUF3QjtBQUd0QkMsRUFBQUEsV0FBVyxDQUNPQyxHQURQLEVBRVRDLE9BRlMsRUFHVEMsTUFIUyxFQUlUQyxRQUpTLEVBSW9DO0FBQUE7O0FBQUE7O0FBQzdDLFFBQUlDLEtBQUo7QUFDQSxRQUFJQyxPQUFlLEdBQUdMLEdBQUcsQ0FBQ00sT0FBSixLQUFnQkMsd0JBQWVDLElBQS9CLEdBQ2xCLENBRGtCLEdBRWxCQyxJQUFJLENBQUNDLEtBQUwsQ0FBV1YsR0FBRyxD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QUNBLFVBQUlDLE1BQU0sS0FBSyxDQUFmLEVBQWtCO0FBQ2hCcEcsUUFBQUEsS0FBSyxDQUFDLFNBQUQsRUFBWW9HLE1BQVosQ0FBTDtBQUNBLGVBQU8sRUFBUDtBQUNEOztBQUNELFlBQU1DLE9BQU8sR0FBSWpDLEtBQUQsR0FBb0IsTUFBcEM7QUFDQSxZQUFNMEIsSUFBSSxHQUFJMUIsS0FBRCxLQUFzQixFQUFuQztBQUNBLGFBQU8sQ0FBQ2lDLE9BQUQsRUFBVVAsSUFBVixDQUFQO0FBQ0QsS0FURCxDQVNFLE9BQU9RLEdBQVAsRUFBWTtBQUNadEcsTUFBQUEsS0FBSyxDQUFDLFNBQUQsRUFBWXNHLEdBQUcsQ0FBQ0MsT0FBSixJQUFlRCxHQUEzQixDQUFMO0FBQ0EsYUFBTyxFQUFQO0FBQ0Q7QUFDRjs7QUF2R3dDOztlQXFINUJ6RSxlIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkuIE9PTyBOYXRhLUluZm9cbiAqIEBhdXRob3IgQW5kcmVpIFNhcmFrZWV2IDxhdnNAbmF0YS1pbmZvLnJ1PlxuICpcbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIHRoZSBcIkBuYXRhXCIgcHJvamVjdC5cbiAqIEZvciB0aGUgZnVsbCBjb3B5cmlnaHQgYW5kIGxpY2Vuc2UgaW5mb3JtYXRpb24sIHBsZWFzZSB2aWV3XG4gKiB0aGUgRVVMQSBmaWxlIHRoYXQgd2FzIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyBzb3VyY2UgY29kZS5cbiAqL1xuXG5pbXBvcnQgeyBQYXRoUmVwb3J0ZXIgfSBmcm9tICdpby10cy9saWIvUGF0aFJlcG9ydGVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBTb2NrZXQsIGNvbm5lY3QgfSBmcm9tICduZXQnO1xuaW1wb3J0IHhwaXBlIGZyb20gJ3hwaXBlJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgZGVidWdGYWN0b3J5IGZyb20gJ2RlYnVnJztcbmltcG9ydCB7IEFkZHJlc3NQYXJhbSB9IGZyb20gJy4uL0FkZHJlc3MnO1xuaW1wb3J0IHsgVGltZW91dEVycm9yIH0gZnJvbSAnLi4vZXJyb3JzJztcbmltcG9ydCB7IGdldFNvY2tldFBhdGggfSBmcm9tICcuLi9pcGMnO1xuLy8gaW1wb3J0IHsgZGV2aWNlcyB9IGZyb20gJy4uL21pYic7XG5pbXBvcnQge1xuICBjcmVhdGVObXNSZWFkLFxuICBObXNEYXRhZ3JhbSxcbn0gZnJvbSAnLi4vbm1zJztcbmltcG9ydCBObXNTZXJ2aWNlVHlwZSBmcm9tICcuLi9ubXMvTm1zU2VydmljZVR5cGUnO1xuaW1wb3J0IHsgY3JlYXRlU2FycCwgU2FycFF1ZXJ5VHlwZSwgU2FycERhdGFncmFtIH0gZnJvbSAnLi4vc2FycCc7XG5pbXBvcnQgeyBNaWJEZXNjcmlwdGlvblYsIElNaWJEZXNjcmlwdGlvbiB9IGZyb20gJy4uL01pYkRlc2NyaXB0aW9uJztcbmltcG9ydCBOaWJ1c0RhdGFncmFtIGZyb20gJy4vTmlidXNEYXRhZ3JhbSc7XG5pbXBvcnQgTmlidXNFbmNvZGVyIGZyb20gJy4vTmlidXNFbmNvZGVyJztcbmltcG9ydCBOaWJ1c0RlY29kZXIgZnJvbSAnLi9OaWJ1c0RlY29kZXInO1xuXG5leHBvcnQgY29uc3QgTUlOSUhPU1RfVFlQRSA9IDB4YWJjNjtcbmNvbnN0IEZJUk1XQVJFX1ZFUlNJT05fSUQgPSAweDg1O1xuY29uc3QgVkVSU0lPTl9JRCA9IDI7XG5cbmNvbnN0IGRlYnVnID0gZGVidWdGYWN0b3J5KCduaWJ1czpjb25uZWN0aW9uJyk7XG5sZXQgTklCVVNfVElNRU9VVCA9IDEwMDA7XG5cbmV4cG9ydCBjb25zdCBzZXROaWJ1c1RpbWVvdXQgPSAodGltZW91dDogbnVtYmVyKSA9PiB7XG4gIE5JQlVTX1RJTUVPVVQgPSB0aW1lb3V0O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldE5pYnVzVGltZW91dCA9ICgpID0+IE5JQlVTX1RJTUVPVVQ7XG5cbmNsYXNzIFdhaXRlZE5tc0RhdGFncmFtIHtcbiAgcmVhZG9ubHkgcmVzb2x2ZTogKGRhdGFncmFtOiBObXNEYXRhZ3JhbSkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcmVhZG9ubHkgcmVxOiBObXNEYXRhZ3JhbSxcbiAgICByZXNvbHZlOiAoZGF0YWdyYW06IE5tc0RhdGFncmFtIHwgTm1zRGF0YWdyYW1bXSkgPT4gdm9pZCxcbiAgICByZWplY3Q6IChyZWFzb246IEVycm9yKSA9PiB2b2lkLFxuICAgIGNhbGxiYWNrOiAoc2VsZjogV2FpdGVkTm1zRGF0YWdyYW0pID0+IHZvaWQpIHtcbiAgICBsZXQgdGltZXI6IE5vZGVKUy5UaW1lcjtcbiAgICBsZXQgY291bnRlcjogbnVtYmVyID0gcmVxLnNlcnZpY2UgIT09IE5tc1NlcnZpY2VUeXBlLlJlYWRcbiAgICAgID8gMVxuICAgICAgOiBNYXRoLmZsb29yKHJlcS5ubXMubGVuZ3RoIC8gMykgKyAxO1xuICAgIGNvbnN0IGRhdGFncmFtczogTm1zRGF0YWdyYW1bXSA9IFtdO1xuICAgIGNvbnN0IHRpbWVvdXQgPSAoKSA9PiB7XG4gICAgICBjYWxsYmFjayh0aGlzKTtcbiAgICAgIGRhdGFncmFtcy5sZW5ndGggPT09IDBcbiAgICAgICAgPyByZWplY3QobmV3IFRpbWVvdXRFcnJvcihcbiAgICAgICAgYFRpbWVvdXQgZXJyb3Igb24gJHtyZXEuZGVzdGluYXRpb259IHdoaWxlICR7Tm1zU2VydmljZVR5cGVbcmVxLnNlcnZpY2VdfWApKVxuICAgICAgICA6IHJlc29sdmUoZGF0YWdyYW1zKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlc3RhcnQgPSAoc3RlcCA9IDEpID0+IHtcbiAgICAgIGNvdW50ZXIgLT0gc3RlcDtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICBpZiAoY291bnRlciA+IDApIHtcbiAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KHRpbWVvdXQsIHJlcS50aW1lb3V0IHx8IE5JQlVTX1RJTUVPVVQpO1xuICAgICAgfSBlbHNlIGlmIChjb3VudGVyID09PSAwKSB7XG4gICAgICAgIGNhbGxiYWNrKHRoaXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50ZXIgPT09IDA7XG4gICAgfTtcbiAgICByZXN0YXJ0KDApO1xuICAgIHRoaXMucmVzb2x2ZSA9IChkYXRhZ3JhbTogTm1zRGF0YWdyYW0pID0+IHtcbiAgICAgIGRhdGFncmFtcy5wdXNoKGRhdGFncmFtKTtcbiAgICAgIGlmIChyZXN0YXJ0KCkpIHtcbiAgICAgICAgcmVzb2x2ZShkYXRhZ3JhbXMubGVuZ3RoID4gMSA/IGRhdGFncmFtcyA6IGRhdGFncmFtKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG59XG5cbnR5cGUgU2FycExpc3RuZXIgPSAoZGF0YWdyYW06IFNhcnBEYXRhZ3JhbSkgPT4gdm9pZDtcbnR5cGUgTm1zTGlzdGVuZXIgPSAoZGF0YWdyYW06IE5tc0RhdGFncmFtKSA9PiB2b2lkO1xuXG5kZWNsYXJlIGludGVyZmFjZSBOaWJ1c0Nvbm5lY3Rpb24ge1xuICBvbihldmVudDogJ3NhcnAnLCBsaXN0ZW5lcjogU2FycExpc3RuZXIpOiB0aGlzO1xuXG4gIG9uKGV2ZW50OiAnbm1zJywgbGlzdGVuZXI6IE5tc0xpc3RlbmVyKTogdGhpcztcblxuICBvbmNlKGV2ZW50OiAnc2FycCcsIGxpc3RlbmVyOiBTYXJwTGlzdG5lcik6IHRoaXM7XG5cbiAgb25jZShldmVudDogJ25tcycsIGxpc3RlbmVyOiBObXNMaXN0ZW5lcik6IHRoaXM7XG5cbiAgYWRkTGlzdGVuZXIoZXZlbnQ6ICdzYXJwJywgbGlzdGVuZXI6IFNhcnBMaXN0bmVyKTogdGhpcztcblxuICBhZGRMaXN0ZW5lcihldmVudDogJ25tcycsIGxpc3RlbmVyOiBObXNMaXN0ZW5lcik6IHRoaXM7XG59XG5cbmNsYXNzIE5pYnVzQ29ubmVjdGlvbiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc29ja2V0OiBTb2NrZXQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5jb2RlciA9IG5ldyBOaWJ1c0VuY29kZXIoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkZWNvZGVyID0gbmV3IE5pYnVzRGVjb2RlcigpO1xuICBwcml2YXRlIHJlYWR5ID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIHByaXZhdGUgY2xvc2VkID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgd2FpdGVkOiBXYWl0ZWRObXNEYXRhZ3JhbVtdID0gW107XG4gIHB1YmxpYyByZWFkb25seSBkZXNjcmlwdGlvbjogSU1pYkRlc2NyaXB0aW9uO1xuXG4gIHByaXZhdGUgc3RvcFdhaXRpbmcgPSAod2FpdGVkOiBXYWl0ZWRObXNEYXRhZ3JhbSkgPT4gXy5yZW1vdmUodGhpcy53YWl0ZWQsIHdhaXRlZCk7XG5cbiAgcHJpdmF0ZSBvbkRhdGFncmFtID0gKGRhdGFncmFtOiBOaWJ1c0RhdGFncmFtKSA9PiB7XG4gICAgbGV0IHNob3dMb2cgPSB0cnVlO1xuICAgIGlmIChkYXRhZ3JhbSBpbnN0YW5jZW9mIE5tc0RhdGFncmFtKSB7XG4gICAgICBpZiAoZGF0YWdyYW0uaXNSZXNwb25zZSkge1xuICAgICAgICBjb25zdCByZXNwID0gdGhpcy53YWl0ZWQuZmluZChpdGVtID0+IGRhdGFncmFtLmlzUmVzcG9uc2VGb3IoaXRlbS5yZXEpKTtcbiAgICAgICAgaWYgKHJlc3ApIHtcbiAgICAgICAgICByZXNwLnJlc29sdmUoZGF0YWdyYW0pO1xuICAgICAgICAgIHNob3dMb2cgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5lbWl0KCdubXMnLCBkYXRhZ3JhbSk7XG4gICAgfSBlbHNlIGlmIChkYXRhZ3JhbSBpbnN0YW5jZW9mIFNhcnBEYXRhZ3JhbSkge1xuICAgICAgdGhpcy5lbWl0KCdzYXJwJywgZGF0YWdyYW0pO1xuICAgICAgc2hvd0xvZyA9IGZhbHNlO1xuICAgIH1cbiAgICBzaG93TG9nICYmXG4gICAgZGVidWcoYGRhdGFncmFtIHJlY2VpdmVkYCwgSlNPTi5zdHJpbmdpZnkoZGF0YWdyYW0udG9KU09OKCkpKTtcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVhZG9ubHkgcGF0aDogc3RyaW5nLCBkZXNjcmlwdGlvbjogSU1pYkRlc2NyaXB0aW9uKSB7XG4gICAgc3VwZXIoKTtcbiAgICBjb25zdCB2YWxpZGF0ZSA9IE1pYkRlc2NyaXB0aW9uVi5kZWNvZGUoZGVzY3JpcHRpb24pO1xuICAgIGlmICh2YWxpZGF0ZS5pc0xlZnQoKSkge1xuICAgICAgY29uc3QgbXNnID0gUGF0aFJlcG9ydGVyLnJlcG9ydCh2YWxpZGF0ZSkuam9pbignXFxuJyk7XG4gICAgICBkZWJ1ZygnPGVycm9yPicsIG1zZyk7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKG1zZyk7XG4gICAgfVxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSB2YWxpZGF0ZS52YWx1ZTtcbiAgICB0aGlzLnNvY2tldCA9IGNvbm5lY3QoeHBpcGUuZXEoZ2V0U29ja2V0UGF0aChwYXRoKSkpO1xuICAgIHRoaXMuc29ja2V0LnBpcGUodGhpcy5kZWNvZGVyKTtcbiAgICB0aGlzLmVuY29kZXIucGlwZSh0aGlzLnNvY2tldCk7XG4gICAgdGhpcy5kZWNvZGVyLm9uKCdkYXRhJywgdGhpcy5vbkRhdGFncmFtKTtcbiAgICB0aGlzLnNvY2tldC5vbmNlKCdjbG9zZScsIHRoaXMuY2xvc2UpO1xuICAgIGRlYnVnKGBuZXcgY29ubmVjdGlvbiBvbiAke3BhdGh9ICgke2Rlc2NyaXB0aW9uLmNhdGVnb3J5fSlgKTtcbiAgfVxuXG4gIHB1YmxpYyBzZW5kRGF0YWdyYW0oZGF0YWdyYW06IE5pYnVzRGF0YWdyYW0pOiBQcm9taXNlPE5tc0RhdGFncmFtIHwgTm1zRGF0YWdyYW1bXSB8IHVuZGVmaW5lZD4ge1xuICAgIC8vIGRlYnVnKCd3cml0ZSBkYXRhZ3JhbSBmcm9tICcsIGRhdGFncmFtLnNvdXJjZS50b1N0cmluZygpKTtcbiAgICBjb25zdCB7IGVuY29kZXIsIHN0b3BXYWl0aW5nLCB3YWl0ZWQsIGNsb3NlZCB9ID0gdGhpcztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5yZWFkeSA9IHRoaXMucmVhZHkuZmluYWxseShhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChjbG9zZWQpIHJldHVybiByZWplY3QobmV3IEVycm9yKCdDbG9zZWQnKSk7XG4gICAgICAgIGlmICghZW5jb2Rlci53cml0ZShkYXRhZ3JhbSkpIHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShjYiA9PiBlbmNvZGVyLm9uY2UoJ2RyYWluJywgY2IpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIShkYXRhZ3JhbSBpbnN0YW5jZW9mIE5tc0RhdGFncmFtKSB8fCBkYXRhZ3JhbS5ub3RSZXBseSkge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgd2FpdGVkLnB1c2gobmV3IFdhaXRlZE5tc0RhdGFncmFtKFxuICAgICAgICAgIGRhdGFncmFtLFxuICAgICAgICAgIHJlc29sdmUsXG4gICAgICAgICAgcmVqZWN0LFxuICAgICAgICAgIHN0b3BXYWl0aW5nLFxuICAgICAgICApKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHBpbmcoYWRkcmVzczogQWRkcmVzc1BhcmFtKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBkZWJ1ZyhgcGluZyBbJHthZGRyZXNzLnRvU3RyaW5nKCl9XSAke3RoaXMucGF0aH1gKTtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIHJldHVybiB0aGlzLnNlbmREYXRhZ3JhbShjcmVhdGVObXNSZWFkKGFkZHJlc3MsIFZFUlNJT05fSUQpKVxuICAgICAgLnRoZW4oKGRhdGFncmFtKSA9PiB7XG4gICAgICAgIHJldHVybiA8bnVtYmVyPihSZWZsZWN0LmdldE93bk1ldGFkYXRhKCd0aW1lU3RhbXAnLCBkYXRhZ3JhbSEpKSAtIG5vdztcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAvLyBkZWJ1ZyhgcGluZyBbJHthZGRyZXNzfV0gZmFpbGVkICR7cmVzb259YCk7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGZpbmRCeVR5cGUodHlwZTogbnVtYmVyID0gTUlOSUhPU1RfVFlQRSkge1xuICAgIGRlYnVnKGBmaW5kQnlUeXBlICR7dHlwZX0gb24gJHt0aGlzLnBhdGh9ICgke3RoaXMuZGVzY3JpcHRpb24uY2F0ZWdvcnl9KWApO1xuICAgIGNvbnN0IHNhcnAgPSBjcmVhdGVTYXJwKFNhcnBRdWVyeVR5cGUuQnlUeXBlLCBbMCwgMCwgMCwgKHR5cGUgPj4gOCkgJiAweEZGLCB0eXBlICYgMHhGRl0pO1xuICAgIHJldHVybiB0aGlzLnNlbmREYXRhZ3JhbShzYXJwKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRWZXJzaW9uKGFkZHJlc3M6IEFkZHJlc3NQYXJhbSk6IFByb21pc2U8bnVtYmVyW10+IHtcbiAgICBjb25zdCBubXNSZWFkID0gY3JlYXRlTm1zUmVhZChhZGRyZXNzLCBWRVJTSU9OX0lEKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB2YWx1ZSwgc3RhdHVzIH0gPSBhd2FpdCB0aGlzLnNlbmREYXRhZ3JhbShubXNSZWFkKSBhcyBObXNEYXRhZ3JhbTtcbiAgICAgIGlmIChzdGF0dXMgIT09IDApIHtcbiAgICAgICAgZGVidWcoJzxlcnJvcj4nLCBzdGF0dXMpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBjb25zdCB2ZXJzaW9uID0gKHZhbHVlIGFzIG51bWJlcikgJiAweEZGRkY7XG4gICAgICBjb25zdCB0eXBlID0gKHZhbHVlIGFzIG51bWJlcikgPj4+IDE2O1xuICAgICAgcmV0dXJuIFt2ZXJzaW9uLCB0eXBlXTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGRlYnVnKCc8ZXJyb3I+JywgZXJyLm1lc3NhZ2UgfHwgZXJyKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY2xvc2UgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMuY2xvc2VkKSByZXR1cm47XG4gICAgY29uc3QgeyBwYXRoLCBkZXNjcmlwdGlvbiB9ID0gdGhpcztcbiAgICBkZWJ1ZyhgY2xvc2UgY29ubmVjdGlvbiBvbiAke3BhdGh9ICgke2Rlc2NyaXB0aW9uLmNhdGVnb3J5fSlgKTtcbiAgICB0aGlzLmNsb3NlZCA9IHRydWU7XG4gICAgdGhpcy5lbmNvZGVyLmVuZCgpO1xuICAgIHRoaXMuZGVjb2Rlci5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICB0aGlzLnNvY2tldC5kZXN0cm95KCk7XG4gICAgdGhpcy5lbWl0KCdjbG9zZScpO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBOaWJ1c0Nvbm5lY3Rpb247XG4iXX0=