<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

# О программе

Название GMIB происходит от начальных букв Graphical User Interface of
[Management Information Base](https://ru.wikipedia.org/wiki/Management_Information_Base)
(графический интерфейс для базы управляющей информации). Изначально данное ПО разрабатывалось для
управления периферийным оборудованием производства компании Ната-Инфо, а именно для опроса состояния
оборудования (хранящегося в различных переменных), изменения его параметров, выполнения встроенных
подпрограмм на оборудовании, обновления и записи аппаратного ПО. В качестве сети связи
использовалась промышленная сеть на собственном проприетарном протоколе NIBUS работающем по
стандарту физического уровня для асинхронных интерфейсов RS-485. Вот цитата из описания протокола
NIBUS:

> Протокол NiBUS обеспечивает набор коммуникационных сервисов, которые позволяют пользовательскому
> приложению в устройстве посылать и получать сообщения от других устройств в сети без необходимости
> знать топологию сети или имена, адреса или функции других устройств. При этом опционально может
> обеспечиваться сквозное подтверждение приема сообщений. Поддержка сетевых управляющих сервисов
> позволяет средствам сетевого управления взаимодействовать с устройствами по сети, включая
> реконфигурацию сетевых параметров, загрузки пользовательских приложений, и старта/стопа/рестарта
> пользовательских приложений устройств. Протокол NiBUS является многоуровневым, пакетно
> ориентированным, одноранговым коммуникационным протоколом. Подобно общепринятым протоколам
> Ethernet и Internet он придерживается рекомендаций многоуровневой архитектуры эталонной модели ISO
> OSI. Однако протокол NiBUS спроектирован для специфичных требований систем управления, а не систем
> обработки данных. Адаптируя протокол для целей управления на каждом OSI уровне, протокол NiBUS
> обеспечивает решение, обеспечивающее надежность, производительность и устойчивость, требуемые
> управляющими приложениями.

Каждый тип оборудования, поддерживающий управление с помощью протокола NIBUS, хранил описание своей
управляющей информации в специальных MIB-файлах с описанием схемы в формате XSD. Для опроса и
управления оборудованием можно было воспользоваться инструментом для командной строки Windows,
указав нужный MIB-файл и требуемую команду, что было несколько неудобно и сложно, особенно для
неподготовленных пользователей. Данная программа позволяла автоматически обнаруживать и
идентифицировать подключенные периферийные устройства, предоставляла удобный интерфейс для
управления ими, была мультиплатформенной и поддерживала основные ОС: Windows, Linux, macOS. В
дальнейшем функционал программы постоянно расширялся и стал поддерживать в том числе и такие функции
как:

- подключение устройств по USB и Ethernet;
- задание параметров (размер, расположение, яркость, адреса устройств) для управления подключенными
  видеоэкранами;
- автоматическое управление яркостью видеоэкранов по показаниям датчиков освещенности или положению
  солнца, с указанием географических координат установленного оборудования;
- периодическое получение и сохранение телеметрии, снижение яркости видеоэкранов при превышении
  критической температуры оборудования;
- автоматический запуск, автообновление, авторизация и аутентификация, удаленное подключение и
  управление;
- поддержка популярных устройств и видеоэкранов сторонних производителей; показ графической
  информации на видеоэкранах, вывод HTML-страниц;
- создание плейлистов с видеоконтентом и воспроизведение видео на экранах;
- планировщик заданий;

Основной режим работы программы — автономный, «настроил и забыл». Оператор подключает оборудование,
задает настройки, включает автозапуск. Далее программа самостоятельно отслеживает текущий статус
оборудования, изменяет параметры согласно заданному плану или в случае нештатных ситуаций.

# Установка и удаление программы

## На Windows

Для установки программы на Windows необходимо запустить установщик
[`gmib-setup-<версия>.exe`](https://github.com/sarakusha/gmib/releases), где версия это три группы
номеров версии (например 4.2.0). Программа автоматически установится в папку по пути
`%LocalAppData%\Programs\gmib`. Данные и настройки программы хранятся в папке `%APPDATA%\gmib`.
Удаление программы осуществляется стандартными средствами Windows через _Установка и удаление
программ_ в _Параметрах системы_.

> Установщики отличаются для 32-разрядных и 64-разрядных версий ОС

## На ОС семейства Linux

Для установки и запуска ПО на Linux используется переносимый формат
[AppImage](https://ru.wikipedia.org/wiki/AppImage), когда вся программа хранится в одном сжатом
файле. Вам нужно скопировать файл [`gmib-x86_64.AppImage/gmib-arm64.AppImage`](https://github.com/sarakusha/gmib/releases) в
домашнюю папку пользователя (или любое другое место на диске), сделать файл исполняемым
(`chmod +x gmib.AppImage`) и запустить. При первом запуске программа сама создаст нужные ярлыки в
меню приложений системы. Данные и настройки программы хранятся в папке `$XDG_CONFIG_HOME/gmib` или
`~/.config/gmib`. Также, если Вы будете использовать функции плеера, необходимо установить ffmpeg
включая ffprobe. Например в Ubuntu это можно сделать командой sudo apt install ffmpeg. Он
используется для конвертации медиа-файлов. Для удаления программы просто удалите файл gmib.AppImage,
также можете удалить папку с данными.
Также может понадобиться добавление текущего пользователя в группу dialout:

```bash
> sudo usermod -a -G dialout $USER
```

Если при подключении устройства оно не распознается и в журнале программы выдается ошибка `LIBUSB_ERROR_ACCESS`,
нужно создать файл `/etc/udev/rules.d/100-gmib.rules` и добавить в него по строке для каждого вида устройств.
Узнайте `VID` и `PID` устройства командой:

```bash
> lsusb

[Вывод команды]
Bus 007 Device 003: ID 10c4:ea60 Silicon Labs CP210x UART Bridge
Bus 007 Device 002: ID 05e3:0608 Genesys Logic, Inc. Hub
Bus 007 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
```

Наше устройство здесь `Silicon Labs CP210x UART Bridge` и его `VID=10c4`, а `PID=ea60`.
Тогда строчка будет выглядеть так:

```
SUBSYSTEM=="usb", ATTRS{idVendor}=="10c4",   ATTRS{idProduct}=="ea60", OWNER="user",   GROUP="plugdev", TAG+="uaccess"
```

Значение OWNER должно содержать имя текущего пользователя.

## На macOS

На macOS вам нужно открыть файл [`gmib-[версия].dmg или gmib-[версия]-arm64.dmg`](https://github.com/sarakusha/gmib/releases) и
переместить его в папку `Application`. Данные и настройки программы хранятся в папке
`~/Library/Application Support/gmib`. Чтобы удалить программу просто удалите её из папки
`Application`. Не забудьте удалить папку с данными, если больше не будете пользоваться программой.

## Обновление ПО

Убедитесь что у вас есть соединение с Интернетом, откройте программу и выберите в меню Помощь пункт
Проверить обновления. Если доступна более новая версия программы, вам будет предложено загрузить
обновление. После загрузки обновления программа автоматически перезапустится.

# Использование программы

## <a name="gui">Интерфейс</a>

Интерфейс программы выглядит практически одинаково на всех платформах. Если на какой-то платформе
наблюдается отличие, об этом будет упомянуто дополнительно. Видеоплеер открывается в собственном
окне и будет описан отдельно.

Интерфейс приложения включает в себя _Меню_, _Навигационную панель_ (**<abbr>НП</abbr>**) в левой
части окна и _Рабочее пространство_ (**<abbr>РП</abbr>**) с названием приложения и текущей версией.
РП может содержать _Панель инструментов_ (**<abbr>ПИ</abbr>**) и _Вкладки_, а содержание зависит от
выбранного пункта в НП. Чтобы понять, за что отвечает та или иная кнопка в ПИ достаточно подвести
курсор к выбранной кнопке и прочитать "всплывающую" подсказку.

> Некоторые пункты НП или группы свойств могут содержать вложенные списки. Тогда рядом с названием
> пункта или группы отображается символы <span class="material-symbols-outlined">expand_more</span>
> или <span class="material-symbols-outlined">expand_less</span> кликнув по которым можно
> свернуть/развернуть вложенный список. Саму НП также можно скрыть/отобразить кликнув по символу
> <span class="material-symbols-outlined">chevron_left</span> или
> <span class="material-symbols-outlined">menu</span>.

## <a name="devices-anchor">Устройства</a>

При запуске и в процессе работы приложение будет подключать доступные устройства и устройства
перечисленные в конфигурации экранов и добавлять их в список Устройства в НП. При выборе устройства
в РП могут быть доступны следующие вкладки:

### <a name="props-anchor">Вкладка _Свойства_</a>

Каждое такое устройство из списка можно выбрать кликнув по нему мышью и в области РП будут
отображаться свойства выбранного устройства, часть из которых можно изменять пользователю.

> Изменение свойств устройства относится к "тонкой" настройке, и должно выполняться
> квалифицированным специалистом. Рядовым пользователям при повседневной эксплуатации обычно не
> требуется изменять эти свойства. Также некоторые свойства, такие как яркость управляются
> централизованно и не должны изменяться для индивидуальных устройств.

Если свойств достаточно много, то они могут быть сгруппированы по группам.

На панели инструментов вкладки Свойства могут быть доступны следующие действия:

- &nbsp;<span class="material-symbols-outlined">system_update_alt</span> Загрузить свойства из
  файла. <br/> Загружает сохраненные ранее свойства из указанного файла.
- &nbsp;<span class="material-symbols-outlined">save</span>Сохранить выбранные свойства в файл.
  <br/> Позволяет сохранить все или указанные значения изменяемых свойств в указанный файл.
- &nbsp;<span class="material-symbols-outlined">refresh</span>Обновить свойства. <br/> Повторно
  перечитать все свойства с устройства.
- &nbsp;<span class="material-symbols-outlined">search</span>Поиск новых устройств. <br/> Открывает
  диалог поиска устройств в сети NIBUS по типу или адресу (см. ниже)

### Диалог _Поиск новых устройств_

Диалог _Поиск устройств_ можно вызвать кликнув по символу
<span class="material-symbols-outlined">search</span> на панели инструментов. С его помощью можно
найти устройства, подключенные к сети NIBUS по RS-485 интерфейсу. Обычно Ваш компьютер должен быть
подключен к общей сети посредством устройства Siolynx.

Поиск устройств можно осуществить по его _типу_ или по _адресу_. Если вы подключены к нескольким
сетям, можно выбрать активное _соединение_, либо искать во всех сетях. Если используется поиск по
типу устройства, нужно выбрать искомый тип из выпадающего списка. Если поиск по адресу, то укажите
искомый адрес. Если все задано, можно начать поиск кликнув кнопку с надписью _Начать_. Если поиск
затянулся, его можно остановить кликнув на _Остановить_. Процесс поиска сопровождается движением
полоски индикатора выполнения. Также в окне будут появляться обнаруженные устройства. Их можно
добавить в общий список устройств кликнув по символу плюс рядом с устройством.

> Если адрес устройства перечислен в свойствах экрана, его поиск будет осуществляться автоматически.

### Вкладка _Телеметрия_

Для некоторых устройств/видеоэкранов доступно получение телеметрии от каждого модуля, которая может
содержать такие параметры как:

- напряжение
- температура
- версия прошивки
- цветовые координаты и т.д.

На панели инструментов вкладки _Телеметрия_ доступны следующие действия:

- &nbsp;<span class="material-symbols-outlined"> filter_4 </span> Выбрать запрашиваемые
  переменные.<br/> Вызывает диалог выбора интересующих параметров (отображает количество выбранных
  параметров)
- &nbsp;<span class="material-symbols-outlined">refresh</span> Запустить опрос модулей. <br/>
  Запускается запрос данных телеметрии указанного диапазона экрана.

Также используя слайдеры можно задать диапазон опрашиваемых модулей по рядам и строкам (на некоторых
устройствах может быть недоступно).

В процессе опроса данные телеметрии будут выдаваться в табличном виде.

> Чем больше запрашиваемых параметров тем дольше производится опрос. Указывайте только интересующие
> вас параметры.

### Вкладка _Прошивка_

Это экспериментальная возможность и предназначена только для специалистов!

## Вывод

Если выбрать данный пункт в НП, то слева можно увидеть список переключателей тестовых режимов, а
справа вкладки с доступными экранами и их параметрами. Включение/выключение переключателя
отображает/скрывает динамический тест на выбранном экране.

На панели инструментов расположены следующие элементы:

- &nbsp;<span class="material-symbols-outlined"> brightness_auto </span> Автояркость.<br/>
  Включает/выключает режим автояркости для выбранного экрана. Если экран в режиме автояркости, то вы
  не можете указать индивидуальную яркость, она задается централизованно.
- **75%** Текущая яркость.<br/> Отображает текущую яркость в процентах
- &nbsp;<span class="material-symbols-outlined"> brightness_4 </span> Уменьшить на единицу.<br/>
  Уменьшает яркость на один процентный пункт. Не активен в режиме автояркость.
- **Слайдер/ползунок**.<br/> Задать яркость. Не активен в режиме автояркость.
- &nbsp;<span class="material-symbols-outlined"> brightness_high </span> Увеличить на единицу.<br/>
  Увеличивает яркость на один процентный пункт. Не активен в режиме автояркость.
- &nbsp;<span class="material-symbols-outlined"> lock </span> Разблокировать/заблокировать
  изменения.<br/> Так как свойства экрана меняются достаточно редко, то чтобы настройки не сбились,
  перед внесением правок необходимо сначала разблокировать свойства экрана.

Перед внесением изменений разблокируйте свойства из панели инструментов. После разблокировки можно
создать новый экран кликнув на вкладке по символу <span class="material-symbols-outlined">
add_to_queue </span> или удалить его <span class="material-symbols-outlined"> close </span>.

Параметры позволяют задать размеры экрана в пикселях, размеры модуля/платы, отступ верхнего левого
угла экрана и дисплей, на который выводить изображение. Дисплей можно указать как _основной_ или
_второстепенный_, либо по его идентификатору. Чтобы узнать идентификатор дисплея, его необходимо
подключить, тогда его номер отобразится в списке доступных.

Также важно задать логические или сетевые адреса минихостов, если вы хотите централизованно
управлять их яркостью и другими параметрами. Каждый экран должен содержать непересекающийся список
адресов. Устройства с указанными адресами будут автоматически обнаружены и включены в список
устройств.

Параметр _Коэффициент_ автояркости может помочь, когда в режиме автояркость используются несколько
экранов с различной абсолютной яркостью. Яркость данного экрана будет рассчитана как общая яркость
(в пункте _Автояркость_) умноженная на указанный коэффициент. Если этот коэффициент равен нулю,
яркость экрана управляется индивидуально и не зависит от общей яркости.

## Автояркость

В левой части находится переключатель, который активирует режим автояркости. В этом режиме текущая
яркость рассчитывается на основе данных, поступающих от внешнего датчика освещенности. Полученные
данные об освещенности в люксах отображаются на полукруглой логарифмической шкале в верхней части
окна. Под циферблатом находится таблица соответствия между освещенностью и яркостью.

> Не обязательно заполнять всю таблицу, но два крайних значения являются обязательными - это
> минимальная и максимальная яркость. Также освещенность и яркость должны возрастать для каждой
> строки таблицы. Текущий уровень яркости будет вычисляться с помощью интерполяции заданных значений
> и лежать в диапазоне от минимальной до максимальной указанной яркости.

Если датчик освещенности отсутствует или неисправен, текущая яркость может быть рассчитана по высоте
солнца. Для этого вам необходимо задать текущие координаты GPS. В этом случае также нужно указать
два крайних значения в таблице: минимальную и максимальную яркость.

> Обратите внимание, что точные координаты должны быть записаны в десятичной нотации, а не в минутах
> и секундах!

В правом углу отображается текущая общая яркость и слайдер, с помощью которого можно ее изменять,
если не включен режим автояркости. Данная яркость будет применена ко всем экранам, для которых
включен режим автояркости (параметр _Коэффициент автояркости_ отличен от нуля).

## Защита от перегрева

Активируется переключателем. Защита от перегрева работает следующим образом: через определенный
_интервал_ времени считывается температура со всех модулей экрана. Далее, в зависимости от заданного
параметра _температуры_ выбирается _максимальное_, _среднее_ или _медианное_ значение и, если оно
превышает _нижнюю границу_ температурного диапазона, яркость экрана уменьшается на указанный _шаг
понижения_. Если в следующем опросе повышение температуры прекратилось, яркость не меняется. Если
температура продолжает расти или она превысила _верхнюю границу_, яркость понижается еще на один
шаг. Если температура опустилась за _нижнюю границу_, яркость начинает возвращаться к желаемому
значению также пошагово.

> Важное замечание: яркость в интерфейсе приложения - это, так называемая, желаемая яркость. Если
> включена защита от перегрева, реальная яркость может быть меньше. Ее реальное значение можно
> увидеть в свойствах устройства.

## Журнал

В журнал записывается различная отладочная информация.

На панели инструментов есть кнопка вызова диалогового окна, которое позволяет выбрать уровень
логирования пересылаемых пакетов и может быть использовано разработчиками.

## Удаленное управление

Это экспериментальная функция. Запущенные экземпляры программы на устройствах в локальной сети (в
рамках одной подсети) могут автоматически обнаруживать друг друга. Все обнаруженные устройства
перечислены в меню _GMIB_ как адрес хоста с номером порта (обычно 9001). При выборе указанного
пункта открывается новое окно и происходит подключение к удаленному хосту. Если это первое
подключение, то запрашивается пароль. При удачном подключении пароль сохраняется и больше не
запрашивается до его явной смены, а в заголовке нового окна отображается адрес удаленного хоста.
Теперь вы можете управлять подключенными устройствами, как будто вы находитесь за удаленным
компьютером.
